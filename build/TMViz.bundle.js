/*! For license information please see TMViz.bundle.js.LICENSE.txt */
var TMViz;TMViz=(()=>{"use strict";var t={8390:(t,e,r)=>{r.r(e),r.d(e,{default:()=>n});const n=r.p+"state-diagram/StateViz.css"},5820:(t,e,r)=>{r.r(e),r.d(e,{default:()=>n});const n=r.p+"tape/tape.css"},6095:(t,e,r)=>{const{TuringMachine:n}=r(7057),a=r(5884),s=r(2618),i=r(7099),{watchInit:o}=r(2645),c=r(5680);function l(t){return c.select(t.domNode).classed("active-edge",!0).transition().style("stroke-width","3px").transition().style("stroke-width","1px").transition().duration(0).each("start",(function(){c.select(this).classed("active-edge",!1)})).style("stroke",null).style("stroke-width",null)}function u(t,e){return new a(t.append("svg").attr("class","tm-tape"),9,e.blank,e.input?String(e.input).split(""):[])}t.exports=class{constructor(t,e,r){t=c.select(t);const a=new s(e.table);this.stateviz=new i(t,a.getVertexMap(),a.getEdges()),null!=r&&(this.positionTable=r),this.edgeAnimation=l,this.stepInterval=100;const d=this;this.machine=new n(function(t,e){return(e,r)=>{const n=t.getInstructionAndEdge(e,r);return null==n?null:(function(t){const e=d.edgeAnimation(t);d.isRunning&&e.transition().duration(d.stepInterval).each("end",(()=>{d.isRunning&&d.step()}))}(n.edge),n.instruction)}}(a),e.startState,u(t,e)),o(this.machine,"state",((t,e,r)=>(c.select(a.getVertex(e).domNode).classed("current-state",!1),c.select(a.getVertex(r).domNode).classed("current-state",!0),r))),this.isHalted=!1,this.counter=0;let h=!1;Object.defineProperty(this,"isRunning",{configurable:!0,get:function(){return h},set:function(t){h!==t&&(h=t,h&&this.step())}}),this.__parentDiv=t,this.__spec=e;let p=0;document.querySelector(".rules tbody").innerHTML="",document.querySelector(".states tbody").innerHTML="";for(let[t,r]of Object.entries(e.table))if(null!==r)for(let[e,{symbol:n,move:a,state:s}]of Object.entries(r))for(let r of e.split(","))document.querySelector(".rules tbody").innerHTML+=`\n          <tr>\n            <td>${++p}</td>\n            <td>${t}</td>\n            <td>${r}</td>\n            <td>${n||r}</td>\n            <td>${a.toString()}</td>\n            <td>${s||t}</td>\n          </tr>`;else document.querySelector(".rules tbody").innerHTML+=`\n          <tr>\n            <td>${++p}</td>\n            <td>${t}</td>\n            <td></td>\n            <td></td>\n            <td></td>\n            <td></td>\n          </tr>`}step(){const t=this.machine.step();t?document.querySelector(".states tbody").innerHTML+=`\n      <tr>\n        <td>${++this.counter}</td>\n        <td>${this.machine.tape.toString()}</td>\n        <td>${t.state}</td>\n      </tr>`:(this.isRunning=!1,this.isHalted=!0)}reset(){this.isRunning=!1,this.isHalted=!1,this.counter=0,this.machine.state=this.__spec.startState,this.machine.tape.domNode.remove(),this.machine.tape=u(this.__parentDiv,this.__spec)}get positionTable(){return this.stateviz.positionTable}set positionTable(t){this.stateviz.positionTable=t}}},7057:(t,e)=>{class r{constructor(t,e,r){this.transition=t,this.state=e,this.tape=r}toString(){return String(this.state)+"\n"+String(this.tape)}step(){const t=this.nextInstruction;return null!=t&&(this.tape.write(t.symbol),function(t,e){switch(e){case n.right:t.headRight();break;case n.left:t.headLeft();break;default:throw new TypeError("not a valid tape movement: "+String(e))}}(this.tape,t.move),this.state=t.state,t)}}Object.defineProperties(r.prototype,{nextInstruction:{get:function(){return this.transition(this.state,this.tape.read())},enumerable:!0},isHalted:{get:function(){return null==this.nextInstruction},enumerable:!0}});var n=Object.freeze({left:{toString:function(){return"L"}},right:{toString:function(){return"R"}}});const a=Object.freeze({left:n.right,right:n.left});e.MoveHead=n,e.MoveTape=a,e.TuringMachine=r},2618:(t,e,r)=>{const n=r(3804);function a(t,e,r){return n.defaults({},r,{state:t,symbol:e})}function s(t){return" "===t?"␣":t}t.exports=class{constructor(t){const e=function(t){const e=n.mapValues(t,((t,e)=>({label:e,transitions:t}))),r=[];return n.forEach(e,((t,i)=>{t.transitions=t.transitions&&(()=>{const o={},c={};return n.forEach(t.transitions,((l,u)=>{const d=u.split(",").reduce(((t,e)=>(""===e&&""===t[t.length-1]?t[t.length-1]=",":t.push(e),t)),[]),h=function(a,s){const i=c[a]||n.tap(c[a]={source:t,target:e[a],labels:[]},r.push.bind(r));return i.labels.push(s),i}(null!=l.state?l.state:i,function(t,e){const r=(null==e.symbol?"":s(String(e.symbol))+",")+String(e.move);return t.map(s).join(",")+"→"+r}(d,l));d.forEach((t=>{o[t]={instruction:a(i,t,l),edge:h}}))})),o})()})),{graph:e,edges:r}}(t);Object.defineProperties(this,{__graph:{value:e.graph},__edges:{value:e.edges}})}getVertexMap(){return this.__graph}getEdges(){return this.__edges}getVertex(t){return this.__graph[t]}getInstructionAndEdge(t,e){const r=this.__graph[t];if(void 0===r)throw new Error("not a valid state: "+String(t));return r.transitions&&r.transitions[e]}}},7099:(t,e,r)=>{const{isBrowserIEorEdge:n}=r(4891),a=r(5680),s=r(6215),{assign:i}=r(3804);function o(t,e){return t.map(((t,r)=>t+e[r]))}function c(t,e){return o(t,e.map((t=>-t)))}function l(t){return Math.sqrt(function(t){return t.map((function(t){return t*t})).reduce((function(t,e){return t+e}),0)}(t))}function u(t,e){return[Math.cos(e)*t,Math.sin(e)*t]}class d{constructor(t){t.forEach((function(t){const e=t.source.index+","+t.target.index;this[e]=(this[e]||0)+1}),this)}numEdgesFromTo(t,e){return this[String(t)+","+String(e)]||0}shapeForEdge(t){return t.target.index===t.source.index?h.loop:this.numEdgesFromTo(t.target.index,t.source.index)?h.arc:h.straight}}const h=Object.freeze({loop:{},arc:{},straight:{}});function p(t){return t}function f(){}function g(t,e,r){return Math.max(t,Math.min(r,e))}const m=n?(t,e)=>t.append("div").style({width:"100%",height:"0","padding-bottom":100*e+"%",position:"relative"}).append("svg").style({position:"absolute",top:"0",left:"0"}):t=>t.append("svg");r(8390);const b=s.mapValues(s.pick(["x","y","px","py","fixed"]));t.exports=class{constructor(t,e,r){const n=800,i=500,b=20,y=a.scale.category10(),x=m(t,i/n);x.attr({viewBox:[0,0,n,i].join(" "),version:"1.1",":xmlns":"http://www.w3.org/2000/svg",":xmlns:xlink":"http://www.w3.org/1999/xlink"});const w=e instanceof Array?e:s.values(e);this.__stateMap=e;var v=a.layout.force().nodes(w).links(r).size([n,i]).linkDistance([140]).charge([-500]).theta(.1).gravity(.05).start();const k=v.drag().on("dragstart",(function(t){t.fixed=!0,x.transition().style("box-shadow","inset 0 0 1px gold")})).on("dragend",(function(){x.transition().style("box-shadow",null)})),S=new d(r),M=x.selectAll(".edgepath").data(r).enter().append("g"),_=(t,e)=>String(-1.1*(e+1))+"em",O=(t,e)=>String(.6+1.1*(e+1))+"em";M.each((function(t,e){const r=a.select(this),n=r.append("path").attr({class:"edgepath",id:"edgepath"+e}).each((function(t){t.domNode=this})),s=r.selectAll(".edgelabel").data(t.labels).enter().append("text").attr("class","edgelabel");s.append("textPath").attr("xlink:href",(()=>"#edgepath"+e)).attr("startOffset","50%").text(p);const i=S.shapeForEdge(t);let d;switch(t.getPath=function(t,e,r){let n,a;return e===h.loop?(n=u(t,-15*Math.PI/180),a=" a 19,27 45 1,1 "+n[0]+","+(n[1]+t),()=>"M "+r.source.x+","+(r.source.y-t)+a):e===h.arc?()=>{const e=[r.source.x,r.source.y],n=[r.target.x,r.target.y],a=c(n,e),s=1.2*l(a),i=function(t){const e=t[0],r=t[1];return Math.atan2(r,e)}(a),d=-Math.PI/2/2,h=o(e,u(t,i+d)),p=o(n,u(t,i+Math.PI-d));return e[0]<=n[0]?"M "+h[0]+" "+h[1]+" A "+s+" "+s+" 0 0,1 "+p[0]+" "+p[1]:"M "+p[0]+" "+p[1]+" A "+s+" "+s+" 0 0,0 "+h[0]+" "+h[1]}:e===h.straight?()=>{const e=[r.source.x,r.source.y],n=[r.target.x,r.target.y],a=c(n,e);if(0===a[0]&&0===a[1])return null;const s=c(n,(i=function(t){const e=l(t);return t.map((t=>t/e))}(a),o=t,i.map((t=>o*t))));var i,o;return"M "+e[0]+" "+e[1]+" L "+s[0]+" "+s[1]}:void 0}(b,i,t),i){case h.straight:s.attr("dy",_),t.refreshLabels=()=>{s.attr("transform",(function(){if(t.target.x<t.source.x){const t={x:(e=this.getBBox()).x+e.width/2,y:e.y+e.height/2};return"rotate(180 "+t.x+" "+t.y+")"}return null;var e}))};break;case h.arc:t.refreshLabels=()=>{const e=t.target.x<t.source.x;e!==d&&(n.classed("reversed-arc",e),s.attr("dy",e?O:_),d=e)};break;case h.loop:s.attr("transform",((t,e)=>"translate("+String(8*(e+1))+" "+String(-8*(e+1))+")")),t.refreshLabels=f}}));const E=M.selectAll(".edgepath"),T=x.selectAll(".node").data(w).enter(),j=T.append("circle").attr("class","node").attr("r",b).style("fill",((t,e)=>y(e))).each((function(t){t.domNode=this})).on("dblclick",(function(t){t.fixed=!1,v.resume()})).call(k),P=T.append("text").attr("class","nodelabel").attr("dy","0.25em").text((t=>t.label));x.append("defs").selectAll("marker").data(["arrowhead","active-arrowhead","reversed-arrowhead","reversed-active-arrowhead"]).enter().append("marker").attr({id:function(t){return t},viewBox:"0 -5 10 10",refX:function(t){return 0===t.lastIndexOf("reversed-",0)?0:10},orient:"auto",markerWidth:10,markerHeight:10}).append("path").attr("d","M 0 -5 L 10 0 L 0 5 Z").attr("transform",(t=>0===t.lastIndexOf("reversed-",0)?"rotate(180 5 0)":null));const A=".edgepath {  marker-end: url(#arrowhead);}.edgepath.active-edge {  marker-end: url(#active-arrowhead);}.edgepath.reversed-arc {  marker-start: url(#reversed-arrowhead);  marker-end: none;}.edgepath.active-edge.reversed-arc {  marker-start: url(#reversed-active-arrowhead);  marker-end: none;}";x.append("style").each((function(){this.styleSheet?this.styleSheet.cssText=A:this.textContent=A})),v.on("tick",(()=>{j.attr({cx:function(t){return t.x=g(b,n-b,t.x)},cy:function(t){return t.y=g(b,i-b,t.y)}}),P.attr("x",(t=>t.x)).attr("y",(t=>t.y)),E.attr("d",(t=>t.getPath())),M.each((t=>{t.refreshLabels()})),w.every((t=>t.fixed))&&v.stop()})),this.force=v}get positionTable(){return b(this.__stateMap)}set positionTable(t){!function(t,e){s.forEach(((e,r)=>{const n=t[r];void 0!==n&&i(e,n)}),e)}(t,this.__stateMap),this.force.resume()}}},7602:(t,e,r)=>{const n=r(6215);t.exports=class{constructor(t,e){Object.defineProperty(this,"blank",{value:t,writable:!1,enumerable:!0}),this.tape={before:[],after:null==e||0==e.length?[t]:e.slice().reverse(),toString:function(){return this.before.join("")+"🔎"+this.after.slice().reverse().join("")}}}read(){return n.last(this.tape.after)}write(t){this.tape.after[this.tape.after.length-1]=t}headRight(){const{before:t,after:e}=this.tape;t.push(e.pop()),n.isEmpty(e)&&e.push(this.blank)}headLeft(){const{before:t,after:e}=this.tape;n.isEmpty(t)&&t.push(this.blank),e.push(t.pop())}toString(){return this.tape.toString()}readOffset(t){const{tape:e}=this;return t>=0?t<=e.after.length-1?e.after[e.after.length-1-t]:this.blank:t>=-e.before.length?e.before[e.before.length+t]:this.blank}readRange(t,e){return n.range(t,e+1).map((function(t){return this.readOffset(t)}),this)}}},5884:(t,e,r)=>{const n=r(7602),a=r(5680);r(5820);function s(t){return t.attr("class","tape-cell"),t.append("rect").datum(null).attr({width:50,height:50}),t.append("text").text((t=>t)).attr({x:25,y:33}),t}function i(t,e){return e=null==e?0:e,t.attr("transform",((t,r)=>"translate("+(50*(r+e)-40)+")")),t}function o(t){t.attr("transform","translate(0 10)").transition().duration(0).select(".exiting").remove()}function c(t,e,r,n,a){e.call(s),r.classed("exiting",!0),t.selectAll(".tape-cell").call(i,a),t.attr("transform","translate("+(50*n).toString()+" 10)").transition().call(o)}t.exports=class extends n{constructor(t,e,r,n){super(r,n),Object.defineProperty(this,"lookaround",{value:e,writable:!1,enumerable:!0}),Object.defineProperty(this,"domNode",{value:t,writable:!1,enumerable:!0});const a=50*(e+1+e-2)+20;t.attr({width:"95%",viewBox:[0,0,a,70].join(" ")}),this.wrapper=t.append("g").attr("class","wrapper").call(o),t.append("rect").attr({id:"tape-head",width:60,height:60,x:50*e-45,y:5}),this.wrapper.selectAll(".tape-cell").data(this.readRange(-e,e)).enter().append("g").call(s).call(i)}write(t){n.prototype.read.call(this)!==t&&(super.write(t),this.wrapper.selectAll(".exiting").remove(),a.select(this.wrapper[0][0].childNodes[this.lookaround]).datum(t).select("text").attr("fill-opacity","1").attr("stroke-opacity","1").transition().attr("fill-opacity","0.4").attr("stroke-opacity","0.1").transition().text((t=>t)).attr("fill-opacity","1").attr("stroke-opacity","1").transition().duration(0).attr("fill-opacity",null).attr("stroke-opacity",null))}headRight(){super.headRight(),this.wrapper.selectAll(".exiting").remove(),c(this.wrapper,this.wrapper.append("g").datum(this.readOffset(this.lookaround)),this.wrapper.select(".tape-cell"),1,-1)}headLeft(){super.headLeft(),this.wrapper.selectAll(".exiting").remove(),c(this.wrapper,this.wrapper.insert("g",":first-child").datum(this.readOffset(-this.lookaround)),this.wrapper.select(".wrapper > .tape-cell:last-of-type"),-1,0)}}},4891:(t,e)=>{const r=Boolean(document.documentMode)||Boolean(window.StyleMedia);e.nonNull=function(t){if(null==t)throw new Error("expected a non-null defined value, but got: "+String(t));return t},e.coalesce=function(t,e){return null!=t?t:e},e.applyMaybe=function(t,e){return null!=e?t(e):e},e.getFirst=function(t,e){for(let r=0;r<e.length;++r){const n=t(e[r]);if(null!=n)return n}},e.toDocFragment=function(t){const e=document.createDocumentFragment();return t.forEach(e.appendChild.bind(e)),e},e.isBrowserIEorEdge=r},2645:(t,e)=>{function r(t,e,r){const n=Object.getOwnPropertyDescriptor(t,e);if(void 0===n)throw new TypeError("Cannot watch nonexistent property '"+e+"'");if(!n.configurable)throw new TypeError("Cannot watch non-configurable property '"+e+"'");if(!n.writable&&void 0===n.set)return;const a=(()=>{if(n.set)return{get:n.get,set:function(a){return n.set.call(t,r.call(t,e,t[e],a))}};{let a=n.value;return{get:function(){return a},set:function(n){return a=r.call(t,e,a,n)}}}})();return Object.defineProperty(t,e,a),n}e.watch=r,e.watchInit=function(t,e,n){const a=t[e],s=r(t,e,n);return s&&(t[e]=a),s}},6215:t=>{t.exports=_},5680:t=>{t.exports=d3},3804:t=>{t.exports=lodash}},e={};function r(n){if(e[n])return e[n].exports;var a=e[n]={exports:{}};return t[n](a,a.exports,r),a.exports}return r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.p="/build/",r(6095)})();
//# sourceMappingURL=TMViz.bundle.js.map