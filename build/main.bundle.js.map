{"version":3,"sources":["webpack://[name]/./src/state-diagram/StateViz.css","webpack://[name]/./src/tape/tape.css","webpack://[name]/./src/examples/_template.yaml","webpack://[name]/./src/examples/binaryAdd.yaml","webpack://[name]/./src/examples/binaryIncrement.yaml","webpack://[name]/./src/examples/binaryMult.yaml","webpack://[name]/./src/examples/busyBeaver3.yaml","webpack://[name]/./src/examples/busyBeaver4.yaml","webpack://[name]/./src/examples/copy1s.yaml","webpack://[name]/./src/examples/divisibleBy3.yaml","webpack://[name]/./src/examples/divisibleBy3Base10.yaml","webpack://[name]/./src/examples/lengthMult.yaml","webpack://[name]/./src/examples/matchBinaryStrings.yaml","webpack://[name]/./src/examples/matchThreeLengths.yaml","webpack://[name]/./src/examples/palindrome.yaml","webpack://[name]/./src/examples/powersOfTwo.yaml","webpack://[name]/./src/examples/repeat01.yaml","webpack://[name]/./src/examples/unaryMult.yaml","webpack://[name]/./src/DocumentMenu.js","webpack://[name]/./src/TMDocument.js","webpack://[name]/./src/TMDocumentController.js","webpack://[name]/./src/TMSimulator.js","webpack://[name]/./src/TMViz.js","webpack://[name]/./src/TuringMachine.js","webpack://[name]/./src/examples.js","webpack://[name]//Users/StevenJoeZhang/myrepo/turing-machine/src/examples|sync|/^\\.\\/.*\\.yaml$/","webpack://[name]/./src/kbdshortcuts.js","webpack://[name]/./src/main.js","webpack://[name]/./src/parser.js","webpack://[name]/./src/sharing/CheckboxTable.js","webpack://[name]/./src/sharing/FileReaderPromise.js","webpack://[name]/./src/sharing/export-panel.js","webpack://[name]/./src/sharing/format.js","webpack://[name]/./src/sharing/gist.js","webpack://[name]/./src/sharing/import-panel.js","webpack://[name]/./src/sharing/import.js","webpack://[name]/./src/state-diagram/StateGraph.js","webpack://[name]/./src/state-diagram/StateViz.js","webpack://[name]/./src/storage.js","webpack://[name]/./src/tape/Tape.js","webpack://[name]/./src/tape/TapeViz.js","webpack://[name]/./src/util.js","webpack://[name]/./src/watch.js","webpack://[name]/external \"ClipboardJS\"","webpack://[name]/external \"Promise\"","webpack://[name]/external \"_\"","webpack://[name]/external \"ace\"","webpack://[name]/external \"d3\"","webpack://[name]/external \"jQuery\"","webpack://[name]/external \"jsyaml\"","webpack://[name]/external \"lodash\"","webpack://[name]/webpack/bootstrap","webpack://[name]/webpack/startup","webpack://[name]/webpack/runtime/define property getters","webpack://[name]/webpack/runtime/hasOwnProperty shorthand","webpack://[name]/webpack/runtime/make namespace object","webpack://[name]/webpack/runtime/publicPath"],"names":["module","exports","KeyValueStorage","TMDocument","d3","defaults","DocumentMenu","args","menu","storagePrefix","firsttimeDocID","group","TypeError","makeOption","this","optionFromDocument","innerHTML","__storagePrefix","doclist","DocumentList","render","selectDocID","getSavedCurrentDocID","self","addEventListener","onChange","currentDocument","type","addStorageListener","e","docID","option","newOption","key","storageKey","readList","IDFromNameStorageKey","findOptionByDocID","parentNode","replaceChild","selected","select","datum","currentDocID","currentOption","value","selectAll","data","list","entry","id","exit","remove","enter","insert","querySelector","replace","opts","write","read","doc","document","createElement","text","name","insertBefore","firstChild","selectedIndex","index","__prepend","newDocument","duplicate","delete","didDeleteEntry","deleteIndex","Object","defineProperties","prototype","get","options","enumerable","opt","__list","unshift","writeList","JSON","parse","stringify","newID","add","copyFrom","deleted","splice","length","String","Date","now","examples","util","_","preset","prefix","isExample","sourceCode","useFallbackGet","positionTable","set","path","join","other","dataKeys","forEach","obj","prop","proto","getPrototypeOf","desc","getOwnPropertyDescriptor","coalesce","call","store","bind","val","stringProp","propDescriptors","applyMaybe","parsePositionTable","stringifyPositionTable","editorSourceCode","keys","string","result","exec","addOutsideChangeListener","listener","re","matches","flow","mapValues","decimalPlaces","multiplier","Math","pow","truncate","round","pick","fixed","truncateCoords","TMSimulator","parser","ace","TMSpecError","YAMLException","UndoManager","require","aceAnnotationFromYAMLException","row","mark","line","column","message","containers","buttons","simulator","editor","edit","session","setOptions","mode","tabSize","useSoftTabs","minLines","maxLines","$blockScrolling","Infinity","editorButtons","load","loadEditorSource","save","focus","revert","revertEditorSource","__document","writable","openDocument","getDocument","forceLoadDocument","keepUndoHistory","setBackingDocument","diagramSource","editorSource","clear","setEditorValue","setUndoManager","isSynced","showCorruptDiagramAlert","hasValidDiagram","undefined","getValue","str","setValue","setAlertErrors","errors","alerts","editorAlerts","append","attr","each","div","annot","lineNum","on","gotoLine","event","preventDefault","reason","html","setAnnotations","map","filter","x","didSucceed","classed","Boolean","__isSynced","setLoadButtonSuccess","removeListener","show","container","revertName","textContent","trim","s","isNewDiagram","parseSpec","TMViz","watchInit","values","step","machine","isRunning","run","reset","all","enable","stepButton","runButton","runHTML","pauseHTML","htmlForRunButton","htmlForPauseButton","oldval","isHalted","disabled","onHaltedChange","onRunningChange","b","__sourceCode","stateviz","force","stop","spec","posTable","__machine","rebindButtons","TuringMachine","TapeViz","StateGraph","StateViz","pulseEdge","edge","domNode","transition","style","duration","addTape","blank","input","split","graph","table","getVertexMap","getEdges","edgeAnimation","stepInterval","animationCallback","state","symbol","tuple","getInstructionAndEdge","instruction","animatedTransition","startState","oldstate","newstate","getVertex","counter","defineProperty","configurable","__parentDiv","__spec","curState","entries","move","curSymbol","toString","tape","instruct","nextInstruction","direction","MoveHead","right","headRight","left","headLeft","freeze","MoveTape","parseDocument","fromPairs","requireExample","examplePairs","isExampleID","hasOwnProperty","pair","hasID","blankTemplate","webpackContext","req","webpackContextResolve","__webpack_require__","o","Error","code","resolve","identity","abbreviateKey","main","commands","getKeylist","platform","altToOption","bindKey","createGetKeylist","tbody","renderTable","d","TMDocumentController","toDocFragment","$","getId","getElementById","addAlertPane","insertAdjacentHTML","importDocument","config","loadModule","test","navigator","userAgent","window","MSStream","importArgs","dialogNode","$importPanel","one","$dialog","gistIDForm","exportPanel","getCurrentDocument","controller","getIsSynced","gistContainer","downloadContainer","copyContentsButton","textarea","docGroup","label","appendChild","exampleGroup","refreshEditMenu","renameLink","deleteLink","wasExample","renameExample","duplicateDocument","removeAttribute","setAttribute","removeEventListener","$renameDialog","callback","insertSnippet","item","modal","keyboard","renameBox","discardReset","newName","rename","getButton","sim","ed","setTheme","addCommand","mac","win","setUseWrapMode","ev","saveCurrentDocID","error","returnValue","isReloading","setTimeout","TM","jsyaml","details","super","stack","header","problemValue","location","synonym","sentences","info","suggestion","parseInstruction","synonyms","checkTarget","moveLeft","moveRight","parseInstructionString","badKey","every","L","R","writeStr","omitBy","makeInstruction","parseInstructionObject","safeLoad","detailsForBlank","checkTableType","actionVal","parseSynonyms","stateObj","parseTable","head","array","headerRow","headerCheckbox","getCheckboxes","property","checked","node","target","tagName","box","refresh","headers","setHeaders","setData","th","tr","order","td","headerBox","indeterminate","boxes","total","size","Promise","readAsText","arguments","reject","onCancel","reader","FileReader","abort","apply","format","createGist","Clipboard","canUseDownloadAttribute","externalHost","canUseCopyCommand","queryCommandSupported","addSelectOnFocus","element","init","setupDialog","filename","contents","stringifyDocument","gistPromise","$alert","prependTo","find","button","oldButtonText","payload","files","description","public","content","then","response","url","urlInput","showGeneratedGist","catch","xhr","responseJSON","status","statusText","alert","generateGist","link","href","encodeURIComponent","download","className","p","createDownloadLink","clipboard","$element","trigger","title","placement","tooltip","clearSelection","cancel","destroy","addClass","cleanup","setSelectionRange","docToYaml","yamlToDoc","invert","mapKeys","mapping","output","fromKey","toKey","update","pos","y","partialRight","safeDump","flowLevel","lineWidth","noRefs","noCompatMode","px","py","InvalidDocumentError","isString","promisifyAjax","jqXHR","textStatus","errorThrown","cancellation","getGist","gistID","ajax","dataType","accepts","docimport","createCloseIcon","class","hideDialog","nextDialog","classList","contains","body","importGist","assign","panelBody","fileInput","importLocalFiles","importContentsButton","position","statusContainer","detailsContainer","role","width","top","transform","statusSummary","showErrorDetails","delay","showImportContentOutcome","importDocumentContents","CheckboxTable","FileReaderPromise","ImportDialog","titleNode","bodyNode","footerNode","cancelButtonNode","__onClose","onClose","empty","backdrop","nodes","joinNodes","appendPanel","titleHTML","panel","emptySelection","appendListPanel","appendTablePanel","isEmptyNonDocs","isEmpty","listNondocuments","dialogBody","nondocs","disclosureTitle","collapseId","otherError","errorString","badDoc","badYAML","tooLarge","wrongType","parseFiles","sizelimit","docfiles","file","search","push","truncated","return","documentFiles","nonDocumentFiles","createDocumentFragment","createTextNode","externalLink","importCommon","dialog","citeLink","citeNode","filesPromise","setBodyChildNodes","tag","wrapTag","gistDescriptionLink","toArray","promise","parsed","pickNone","close","importDocuments","ctable","n","ceil","toFixed","importButton","names","getCheckedValues","has","isCheckedEmpty","pickMultiple","docs","concat","reverse","messageForError","waitForDialog","createElementHTML","pre","runImport","queryString","decode","decodeURIComponent","decodeFormURLComponent","queryParams","substring","finally","history","replaceState","pathname","normalize","visibleSpace","c","derived","transitions","allEdges","vertex","stateTransitions","cache","symbolKey","symbols","reduce","acc","tap","source","labels","edgeTo","action","rightSide","labelFor","edges","deriveGraph","__graph","__edges","isBrowserIEorEdge","addV","array1","array2","i","subtractV","normV","sqrt","normSqV","vectorFromLengthAngle","angle","cos","sin","EdgeCounter","src","EdgeShape","loop","numEdgesFromTo","arc","straight","noop","limitRange","min","max","appendSVGTo","hwRatio","height","getPositionTable","linkArray","w","h","nodeRadius","colors","scale","category10","svg","nodeArray","Array","__stateMap","layout","links","linkDistance","charge","theta","gravity","start","drag","edgeCounter","edgegroups","labelAbove","labelBelow","edgeD","edgeIndex","edgepath","shape","shapeForEdge","isFlipped","getPath","loopEndOffset","loopArc","PI","p1","p2","offset","radius","atan2","angleV","sep","unitV","scalar","edgePathFor","refreshLabels","svgrect","getBBox","shouldFlip","edgepaths","nodeSelection","nodecircles","resume","nodelabels","lastIndexOf","svgCSS","styleSheet","cssText","cx","cy","stateMap","setPositionTable","canUseLocalStorage","mod","localStorage","setItem","removeItem","RAMStorage","getItem","fromOwnWindow","hasFocus","storageArea","removeStorageListener","before","after","slice","last","pop","end","range","readOffset","Tape","initTapeCells","selection","cellWidth","cellHeight","positionCells","repositionWrapper","wrapper","moveHead","wOffset","cOffset","lookaround","readRange","childNodes","documentMode","StyleMedia","nonNull","a","f","getFirst","xs","watch","thisArg","handler","accessors","newval","ClipboardJS","jQuery","lodash","__webpack_module_cache__","moduleId","__webpack_modules__","definition","r","Symbol","toStringTag"],"mappings":"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","file":"main.bundle.js","sourcesContent":["export default __webpack_public_path__ + \"state-diagram/StateViz.css\";","export default __webpack_public_path__ + \"tape/tape.css\";","module.exports = \"input: '${2}'\\nblank: '${3: }'\\nstart state: ${4:start}\\ntable:\\n  ${4}:\\n    ${5}\\n\";","module.exports = \"name: binary addition\\nsource code: |\\n  # Adds two binary numbers together.\\n\\n  # Format: Given input a+b where a and b are binary numbers,\\n  # leaves c b on the tape, where c = a+b.\\n  # Example: '11+1' => '100 1'.\\n  input: '1011+11001'\\n  blank: ' '\\n  start state: right\\n  table:\\n    # Start at the second number's rightmost digit.\\n    right:\\n      [0,1,+]: R\\n      ' ': {L: read}\\n\\n    # Add each digit from right to left:\\n    # read the current digit of the second number,\\n    read:\\n      0: {write: c, L: have0}\\n      1: {write: c, L: have1}\\n      +: {write: ' ', L: rewrite}\\n    # and add it to the next place of the first number,\\n    # marking the place (using O or I) as already added.\\n    have0: {[0,1]: L, +: {L: add0}}\\n    have1: {[0,1]: L, +: {L: add1}}\\n    add0:\\n      [0,' ']: {write: O, R: back0}\\n      1      : {write: I, R: back0}\\n      [O,I]  : L\\n    add1:\\n      [0,' ']: {write: I, R: back1}\\n      1      : {write: O, L: carry}\\n      [O,I]  : L\\n    carry:\\n      [0,' ']: {write: 1, R: back1}\\n      1      : {write: 0, L}\\n    # Then, restore the current digit, and repeat with the next digit.\\n    back0:\\n      [0,1,O,I,+]: R\\n      c: {write: 0, L: read}\\n    back1:\\n      [0,1,O,I,+]: R\\n      c: {write: 1, L: read}\\n\\n    # Finish: rewrite place markers back to 0s and 1s.\\n    rewrite:\\n      O: {write: 0, L}\\n      I: {write: 1, L}\\n      [0,1]: L\\n      ' ': {R: done}\\n    done:\\n\\n\\n  # Exercise:\\n\\n  #  Generate the Fibonacci sequence in binary, listed from right to left:\\n  #   ...1101 1000 101 11 10 1 1 0\\n  #   Hint: prefix the current number with a +, copy the previous number\\n  #   and place it left of the +, run the adder, and repeat.\\n  #   Example: '1 0' => '+1 0' => '0+1 0' => '1 1 0' => '+1 1 0' => ...\\npositions:\\n  right:   {x: 300, y: 130}\\n  rewrite: {x: 500, y: 130}\\n  done:    {x: 620, y: 130}\\n\\n  back0:  {x: 250, y: 250}\\n  read:   {x: 400, y: 250}\\n  back1:  {x: 550, y: 250}\\n  carry:  {x: 650, y: 250}\\n\\n  add0:   {x: 150, y: 400}\\n  have0:  {x: 300, y: 400}\\n  have1:  {x: 500, y: 400}\\n  add1:   {x: 650, y: 400}\\n\";","module.exports = \"name: binary increment\\nsource code: |\\n  # Adds 1 to a binary number.\\n  input: '1011'\\n  blank: ' '\\n  start state: right\\n  table:\\n    # scan to the rightmost digit\\n    right:\\n      [1,0]: R\\n      ' '  : {L: carry}\\n    # then carry the 1\\n    carry:\\n      1      : {write: 0, L}\\n      [0,' ']: {write: 1, L: done}\\n    done:\\n\\n\\n  # Exercises:\\n\\n  #  Modify the machine to always halt on the leftmost digit\\n  #   (regardless of the number's length).\\n  #   Hint: add a state between carry and done.\\n\\n  #  Make a machine that adds 2 instead of 1.\\n  #   Hint: 2 is '10' in binary, so the last digit is unaffected.\\n  #   Alternative hint: chain together two copies of the machine from\\n  #   the first exercise (renaming the states of the second copy).\\n\\n  #  Make a machine to subtract 1.\\n  #   To simplify things, assume the input is always greater than 0.\\npositions:\\n  right: {x: 230, y: 250}\\n  carry: {x: 400, y: 250}\\n  done: {x: 570, y: 250}\\n\";","module.exports = \"name: binary multiplication\\nsource code: |\\n  # Multiplies two binary numbers together.\\n\\n  # Examples: '11*11' => '1001', '111*110' => '101010'.\\n  input: '11*101' # 3*5 = 15 (1111 in binary)\\n  blank: ' '\\n  start state: start\\n  table:\\n    # Prefix the input with a '+', and go to the rightmost digit.\\n    start:\\n      [0,1]: {L: init}\\n    init:\\n      ' ': {write: '+', R: right}\\n    right:\\n      [0,1,'*']: R\\n      ' ': {L: readB}\\n\\n    # Read and erase the last digit of the multiplier.\\n    # If it's 1, add the current multiplicand.\\n    # In any case, double the multiplicand afterwards.\\n    readB:\\n      0: {write: ' ', L: doubleL}\\n      1: {write: ' ', L: addA}\\n    addA:\\n      [0,1]: L\\n      '*': {L: read} # enter adder\\n    # Double the multiplicand by appending a 0.\\n    doubleL:\\n      [0,1]: L\\n      '*': {write: 0, R: shift}\\n    double: # return from adder\\n      [0,1,+]: R\\n      '*': {write: 0, R: shift}\\n    # Make room by shifting the multiplier right 1 cell.\\n    shift:\\n      0: {write: '*', R: shift0}\\n      1: {write: '*', R: shift1}\\n      ' ': {L: tidy} # base case: multiplier = 0\\n    shift0:\\n      0:   {R: shift0}\\n      1:   {write: 0, R: shift1}\\n      ' ': {write: 0, R: right}\\n    shift1:\\n      0:   {write: 1, R: shift0}\\n      1:   {R: shift1}\\n      ' ': {write: 1, R: right}\\n\\n    tidy:\\n      [0,1]: {write: ' ', L}\\n      +: {write: ' ', L: done}\\n    done:\\n\\n  # This is the 'binary addition' machine almost verbatim.\\n  # It's adjusted to keep the '+'\\n  # and to lead to another state instead of halting.\\n    read:\\n      0: {write: c, L: have0}\\n      1: {write: c, L: have1}\\n      +: {L: rewrite} # keep the +\\n    have0: {[0,1]: L, +: {L: add0}}\\n    have1: {[0,1]: L, +: {L: add1}}\\n    add0:\\n      [0,' ']: {write: O, R: back0}\\n      1      : {write: I, R: back0}\\n      [O,I]  : L\\n    add1:\\n      [0,' ']: {write: I, R: back1}\\n      1      : {write: O, L: carry}\\n      [O,I]  : L\\n    carry:\\n      [0,' ']: {write: 1, R: back1}\\n      1      : {write: 0, L}\\n    back0:\\n      [0,1,O,I,+]: R\\n      c: {write: 0, L: read}\\n    back1:\\n      [0,1,O,I,+]: R\\n      c: {write: 1, L: read}\\n    rewrite:\\n      O: {write: 0, L}\\n      I: {write: 1, L}\\n      [0,1]: L\\n      ' ': {R: double} # when done, go to the 'double' state\\n\\n\\n  # Remark:\\n  # We can view the machine as expressing a recursive function:\\n\\n  #   multiply(a, b) = mult(0, a, b)\\n\\n  #   mult(acc, a, 0     ) = acc\\n  #   mult(acc, a, 2k + 0) = mult(acc    , 2a, k)   where k  0\\n  #   mult(acc, a, 2k + 1) = mult(acc + a, 2a, k)\\n\\n  # where a, b, and k are natural numbers.\\n\\n  # Each reduction maintains the invariant\\n  #   mult(acc, a, b) = acc + a * b\\n  # Note that mult's third argument (b) is always decreasing,\\n  # so mult is guaranteed to halt.\\n  # Eventually b reaches 0 and the result is simply the accumulator.\\npositions:\\n  start:  {x: 80 , y: 70}\\n  init:   {x: 190, y: 70}\\n  tidy:   {x: 730, y: 70}\\n  done:   {x: 730, y: 180}\\n\\n  right:  {x: 300, y: 115}\\n  shift:  {x: 600, y: 115}\\n  shift1: {x: 450, y: 70}\\n  shift0: {x: 450, y: 160}\\n\\n  readB:  {x: 300, y: 215}\\n  addA:   {x: 160, y: 215}\\n  doubleL: {x: 550, y: 215}\\n\\n  rewrite: {x: 363, y: 300}\\n  double: {x: 650, y: 300}\\n\\n  back0:  {x: 160, y: 370}\\n  read:   {x: 300, y: 370}\\n  back1:  {x: 440, y: 370}\\n  carry:  {x: 540, y: 370}\\n\\n  add0:   {x:  60, y: 470}\\n  have0:  {x: 200, y: 470}\\n  have1:  {x: 400, y: 470}\\n  add1:   {x: 540, y: 470}\\n\";","module.exports = \"name: 3-state busy beaver\\nsource code: |\\n  # A 3-state 2-symbol busy beaver for most non-blank symbols.\\n  # It takes 13 steps and leaves 6 non-blank symbols on the tape.\\n\\n  # What's a \\\"busy beaver\\\"?\\n  #   Suppose every possible Turing machine with n states and k symbols\\n  #   (for instance, 3 states and 2 symbols) were started on\\n  #   a blank tape with no input.\\n  #   Some of the machines would never halt. Out of the ones that do halt,\\n  #   a machine that leaves the most non-blank symbols on the tape\\n  #   is called a busy beaver.\\n  blank: '0'\\n  start state: A\\n  table:\\n    A:\\n      0: {write: 1, R: B}\\n      1: {L: C}\\n    B:\\n      0: {write: 1, L: A}\\n      1: R\\n    C:\\n      0: {write: 1, L: B}\\n      1: {R: H}\\n    H:\\n\\n  # An alternative criterion is halting after the most steps.\\n  # This busy beaver takes the most steps (21) but only prints 5 1's:\\n    # A:\\n    #   0: {write: 1, R: B}\\n    #   1: {R: H}\\n    # B:\\n    #   0: {write: 1, L: B}\\n    #   1: {write: 0, R: C}\\n    # C:\\n    #   0: {write: 1, L}\\n    #   1: {L: A}\\n    # H:\\n\\n\\n  # Exercise:\\n\\n  #  Consider Turing machines that have n states and k symbols.\\n  #   Instead of a missing instruction, halting is denoted by\\n  #   a transition to a special \\\"halt\\\" state (for a total of n+1 states).\\n  #   How many different transition functions are possible?\\n\\n  #   Hint: Each instruction writes a symbol, moves left or right,\\n  #   and goes to a state.\\n  #   There is one instruction per combination of non-halt state & symbol.\\n\\n\\n\\n  #   Answer: (2k(n+1))^(nk)\\npositions:\\n  A: {x: 320, y: 296.188}\\n  B: {x: 400, y: 157.624}\\n  C: {x: 480, y: 296.188}\\n  H: {x: 400, y: 376.188}\\n\";","module.exports = \"name: 4-state busy beaver\\nsource code: |\\n  # A 4-state 2-symbol busy beaver\\n  # that halts after 107 steps, leaving 13 1's on the tape.\\n  # It takes the most steps *and* prints the most 1's.\\n  blank: 0\\n  start state: A\\n  table:\\n    A: {0: {write: 1, R: B}, 1:           {L: B}}\\n    B: {0: {write: 1, L: A}, 1: {write: 0, L: C}}\\n    C: {0: {write: 1, R: H}, 1:           {L: D}}\\n    D: {0: {write: 1, R   }, 1: {write: 0, R: A}}\\n    H:\\n\\n\\n  # Finding a busy beaver requires considering every n-state k-symbol\\n  # machine and proving either that it halts with no more non-blank symbols\\n  # or that it never halts at all.\\n\\n  # Even with strategies to reduce the search space\\n  # including normalization, accelerated simulation, and automated proofs\\n  # there are still machines that show surprising complexity\\n  # and require individual analysis.\\n\\n  # This 4-state busy beaver was proven by Allen Brady in 1983.\\n  # Busy beavers for 5 states and above are as yet unknown.\\n  # At the time of writing, the current 5-state 2-symbol contender\\n  # takes 47,176,870 steps to halt, and the 6-state contender\\n  # takes over 7.4 * 10^36534 steps\\n  # (http://www.logique.jussieu.fr/~michel/bbc.html).\\n  # \\\"Given that 5-state 2-symbol halting Turing machines can compute\\n  # Collatz-like congruential functions, it may be very hard to find\\n  # [the next busy beaver]\\\" (https://oeis.org/A060843).\\n\\n\\n  # An entertaining read on busy beavers and their profoundness:\\n\\n  #  \\\"Who Can Name the Bigger Number?\\\"\\n  #   http://www.scottaaronson.com/writings/bignumbers.html\\npositions:\\n  # square with side length 160\\n  A: {x: 320, y: 170}\\n  B: {x: 480, y: 170}\\n\\n  C: {x: 480, y: 330}\\n  D: {x: 320, y: 330}\\n  H: {x: 620, y: 330}\\n\";","module.exports = \"name: copy 1s\\nsource code: |\\n  # Copies a string of consecutive 1s.\\n  input: '111'\\n  blank: 0\\n  start state: each\\n  table:\\n    # mark the current 1 by erasing it\\n    each:\\n      0: {R: H}\\n      1: {write: 0, R: sep}\\n    # skip to the separator\\n    sep:\\n      0: {R: add}\\n      1: R\\n    # skip to the end of the copy and write a 1\\n    add:\\n      0: {write: 1, L: sepL}\\n      1: R\\n    # return to the separator\\n    sepL:\\n      0: {L: next}\\n      1: L\\n    # return to the erased 1, restore it, and then advance to the next 1\\n    next:\\n      0: {write: 1, R: each}\\n      1: L\\n    H:\\n\\n\\n  # Exercises:\\n\\n  #  Edit the machine to copy the string indefinitely,\\n  #   i.e. given the input '11', produce 11011011011...\\n  #   Hint: this can be done by modifying only one transition.\\n\\n  #  Make a machine to output the endless sequence 1011011101111011111...\\npositions:\\n  each: {x: 400   , y: 100}\\n  sep:  {x: 400.01, y: 250}\\n  add:  {x: 400.02, y: 400}\\n  sepL: {x: 250   , y: 250}\\n  next: {x: 250.01, y: 100}\\n  H:    {x: 550   , y: 100}\\n\";","module.exports = \"name: divisible by 3\\nsource code: |\\n  # Checks if a binary number is divisible by 3.\\n  input: '1001' # try '1111' (15), '10100' (20), '111001' (57)\\n  blank: ' '\\n  # How it works:\\n\\n  # Consider reading a binary number, say 10011 (19),\\n  # from left to right one digit at a time.\\n  # Each time a digit is read, the new value equals the new digit\\n  # plus the old value shifted left one place (multiplied by 2).\\n\\n  # Digits  Value\\n  # -------------\\n  #         0\\n  # 1       1\\n  # 10      2\\n  # 100     4\\n  # 1001    9\\n  # 10011   19\\n\\n  # Now instead of tracking the entire number, just track the remainder.\\n  # It works the same way.\\n  start state: q0\\n  table:\\n    q0:\\n      0: R       # 2*0 + 0 = 0\\n      1: {R: q1} # 2*0 + 1 = 1\\n      ' ': {R: accept}\\n    q1:\\n      0: {R: q2} # 2*1 + 0 = 2\\n      1: {R: q0} # 2*1 + 1 = 3\\n    q2:\\n      0: {R: q1} # 2*2 + 0 = 4\\n      1: {R: q2} # 2*2 + 1 = 5\\n    accept:\\n\\n\\n  # Exercises:\\n\\n  #  Modify the machine to check if n-1 is divisible by 3,\\n  #   where n is the input. That is, accept the binary of 1, 4, 7, 10, ...\\n  #   Hint: this can be done without modifying the tape (no 'write').\\n\\n  #  Round the number up to the nearest multiple of 3.\\n  #   Hint: do one pass right to find the remainder, then another pass left\\n  #   to add. See the 'binary increment' example for how to add.\\n\\n  #  Round the number down to the nearest multiple of 3.\\npositions:\\n  q0: {x: 230, y: 250}\\n  q1: {x: 400, y: 250}\\n  q2: {x: 570, y: 250}\\n  accept: {x: 230.01, y: 380}\\n\";","module.exports = \"name: divisible by 3 (base 10)\\nsource code: |\\n  # Checks if a base 10 number is divisible by 3.\\n  input: 4728 # try 42, 57, 1337, 5328, 7521, 314159265\\n  blank: ' '\\n  # This uses the same idea as the base 2 version.\\n  #\\n  # To make things more interesting, we derive the step relation:\\n  # Let x be the number left of the tape head,\\n  #     d the digit under the head, and\\n  #     x' the number up to and including the head.\\n  # Then\\n  #   x' = 10x + d .\\n  # Notice 10  1 (mod 3). Therefore\\n  #   x'  x + d (mod 3) .\\n  # Each step simply adds the new digit's remainder mod 3.\\n  start state: q0\\n  table:\\n    q0:\\n      [0,3,6,9]: R     # 0 + 0  0 (mod 3)\\n      [1,4,7]: {R: q1} # 0 + 1  1\\n      [2,5,8]: {R: q2} # 0 + 2  2\\n      ' ': {R: accept}\\n    q1:\\n      [0,3,6,9]: R     # 1 + 0  1\\n      [1,4,7]: {R: q2} # 1 + 1  2\\n      [2,5,8]: {R: q0} # 1 + 2  0\\n    q2:\\n      [0,3,6,9]: R     # 2 + 0  2\\n      [1,4,7]: {R: q0} # 2 + 1  0\\n      [2,5,8]: {R: q1} # 2 + 2  1\\n    accept:\\n\\n\\n  # Exercises:\\n\\n  #  Check for divisibility by 5.\\n  #   Hint: only 2 states (besides accept) are required.\\n\\n  #  Check for divisibility by 4.\\n  #   Hint: use 4 states (besides accept).\\npositions:\\n  # centered equilateral triangle with side length 250\\n  q0: {x: 275, y: 322.1688}\\n  q1: {x: 400, y: 105.6624}\\n  q2: {x: 525, y: 322.1688}\\n  accept: {x: 275.01, y: 430}\\n\";","module.exports = \"name: multiplied lengths\\nsource code: |\\n  # Decides the language { a^(i)b^(j)c^(k) | i*j = k and i,j,k  1 }.\\n  # (a's followed by b's then c's,\\n  # where the number of a's multiplied by the number of b's\\n  # equals the number of c's.)\\n  input: aabbbcccccc # try abc, b, aabcbc, aabcc, aabbbbcccccccc\\n  blank: ' '\\n  start state: start\\n\\n  table:\\n    # Check for the form a^(i)b^(j)c^(k) where i,j,k  1.\\n    start:  {        a: {R: a+}}\\n    a+:     {a: R,   b: {R: b+}}\\n    b+:     {b: R,   c: {R: c+}}\\n    c+:     {c: R, ' ': {L: left}}\\n    left:\\n      [a,b,c]: L\\n      ' ': {R: eachA}\\n    # Then check that i*j = k.\\n    #   The approach is two nested loops:\\n    #   For each 'a':\\n    #     For each 'b':\\n    #       Mark one 'c'\\n    #   At the end, check that all c's are marked.\\n    eachA:\\n      a: {write: ' ', R: eachB}\\n      b: {R: scan}\\n    eachB:\\n      a: R\\n      b: {write: B, R: markC}\\n      C: {L: nextA}\\n    markC:\\n      [b,C]: R\\n      c: {write: C, L: nextB}\\n    nextB:\\n      [b,C]: L\\n      B: {R: eachB}\\n    nextA:\\n      a: L\\n      B: {write: b, L}\\n      ' ': {R: eachA}\\n\\n    scan:\\n      [b,C]: R\\n      ' ': {R: accept}\\n    accept:\\npositions:\\n  start:  {x: 180, y: 40}\\n  a+:     {x: 180, y: 180}\\n  b+:     {x: 180, y: 320}\\n  c+:     {x: 180, y: 460}\\n  left:   {x: 290, y: 320}\\n\\n  accept: {x: 400, y: 40}\\n  eachA:  {x: 400, y: 180}\\n  eachB:  {x: 400, y: 320}\\n  markC:  {x: 400, y: 460}\\n\\n  scan:   {x: 560, y: 180}\\n  nextA:  {x: 560, y: 320}\\n  nextB:  {x: 560, y: 460}\\n\";","module.exports = \"name: equal strings\\nsource code: |\\n  # Decides the language { w#w | w  {0,1}* }\\n  # (two equal binary strings separated by '#')\\n  input: '01001#01001' # try '#', '1#10', '10#1', '10#10'\\n  blank: ' '\\n  # Two strings are equal if they are both the empty string,\\n  # or they start with the same symbol and are equal thereafter.\\n  start state: start\\n  table:\\n    start:\\n      # Inductive case: start with the same symbol.\\n      0: {write: ' ', R: have0}\\n      1: {write: ' ', R: have1}\\n      # Base case: empty string.\\n      '#': {R: check}\\n    have0:\\n      [0,1]: R\\n      '#': {R: match0}\\n    have1:\\n      [0,1]: R\\n      '#': {R: match1}\\n    match0:\\n      x: R\\n      0: {write: x, L: back}\\n    match1:\\n      x: R\\n      1: {write: x, L: back}\\n    back:\\n      [0,1,'#',x]: L\\n      ' ': {R: start}\\n    check:\\n      x: R\\n      ' ': {R: accept}\\n    accept:\\n\\n\\n  # Exercises:\\n\\n  #  Accept if the second string is the bitwise complement\\n  #   (1s and 0s swapped) of the first, e.g. accept '1101#0010'.\\n\\n  #  Check that a binary string has the same number of 0s and 1s;\\n  #   eg., accept '001110' but reject '10010'.\\n\\n  #  Check if two strings are different.\\n  #   Example: accept '00#001' and '0101#0111', but reject '1001#1001'.\\npositions:\\n  accept: {x: 80 , y: 250}\\n  check:  {x: 190, y: 250}\\n  # regular hexagon with side length 150\\n  start:  {x: 300, y: 250}\\n  back:   {x: 600, y: 250}\\n  have1:  {x: 375, y: 120.10}\\n  match1: {x: 525, y: 120.10}\\n  have0:  {x: 375, y: 379.90}\\n  match0: {x: 525, y: 379.90}\\n\";","module.exports = \"name: three equal lengths\\nsource code: |\\n  # Decides the language { abc | n  1 }, that is,\\n  # accepts a's followed by b's then c's of the same length.\\n  input: aabbcc # try bac, aabc, aabcc, aabcbc\\n  blank: ' '\\n  # Mark the first a, b, and c on each pass (by capitalizing them).\\n  # All a's must precede all b's, which must precede all c's.\\n  # When there are no more a's,\\n  # all input symbols should have been marked.\\n  start state: qA\\n  table:\\n    qA:\\n      a: {write: A, R: qB}\\n      B: {R: scan}\\n    qB:\\n      [a,B]: R\\n      b: {write: B, R: qC}\\n    qC:\\n      [b,C]: R\\n      c: {write: C, L: back}\\n    back:\\n      [a,B,b,C]: L\\n      A: {R: qA}\\n    scan:\\n      [B,C]: R\\n      ' ': {R: accept}\\n    accept:\\n\\n\\n  # Exercises:\\n\\n  #  Suppose a ledger starts from 0 and gains one dollar for each +\\n  #   and loses one for each -. Reading left to right,\\n  #   check that the account never goes into the negative.\\n  #   Examples: accept '+-++' and '++-+--', reject '-++' and '++---+'.\\n\\n  #  Check parentheses for proper nesting,\\n  #   e.g. accept '()(()()())' but reject '(()))(' and '(()('.\\npositions:\\n  qA: {x: 240, y: 250}\\n  qB: {x: 400, y: 250}\\n  qC: {x: 560, y: 250}\\n  back:   {x: 400, y: 370}\\n  scan:   {x: 320, y: 150}\\n  accept: {x: 480, y: 150}\\n\";","module.exports = \"name: palindrome\\nsource code: |\\n  # Accepts palindromes made of the symbols 'a' and 'b'\\n  input: 'abba' # try a, ab, bb, babab\\n  blank: ' '\\n  start state: start\\n  synonyms:\\n    accept: {R: accept}\\n    reject: {R: reject}\\n  # A palindrome is either the empty string, a single symbol,\\n  # or a (shorter) palindrome with the same symbol added to both ends.\\n  table:\\n    start:\\n      a: {write: ' ', R: haveA}\\n      b: {write: ' ', R: haveB}\\n      ' ': accept # empty string\\n    haveA:\\n      [a,b]: R\\n      ' ': {L: matchA}\\n    haveB:\\n      [a,b]: R\\n      ' ': {L: matchB}\\n    matchA:\\n      a: {write: ' ', L: back} # same symbol at both ends\\n      b: reject\\n      ' ': accept # single symbol\\n    matchB:\\n      a: reject\\n      b: {write: ' ', L: back} # same symbol at both ends\\n      ' ': accept # single symbol\\n    back:\\n      [a,b]: L\\n      ' ': {R: start}\\n    accept:\\n    reject:\\n\\n\\n  # Exercise:\\n\\n  #  Modify the machine to include 'c' in the symbol alphabet,\\n  #   so it also works for strings like 'cabbac'.\\npositions:\\n  haveA:  {x: 240, y: 185}\\n  start:  {x: 400, y: 185}\\n  haveB:  {x: 560, y: 185}\\n\\n  matchA: {x: 240, y: 315}\\n  back:   {x: 400, y: 315}\\n  matchB: {x: 560, y: 315}\\n\\n  accept: {x: 400, y: 55}\\n  reject: {x: 400, y: 445}\\n\";","module.exports = \"name: powers of two\\nsource code: |\\n  # Matches strings of 0s whose length is a power of two.\\n\\n  # This example comes from the textbook\\n  #   \\\"Introduction to the Theory of Computation\\\" (3rd edition, 2012)\\n  #   by Michael Sipser\\n  # The states have been renamed (from q1, q2, etc.)\\n  # to make it easier to understand.\\n  input: '0000' # try '0', '000', '00000000'\\n  blank: ' '\\n  start state: zero\\n  synonyms:\\n    accept: {R: accept}\\n    reject: {R: reject}\\n  # The idea: divide the length by 2 repeatedly until it reaches 1.\\n\\n  # To do this, cross off every other 0, one pass at a time.\\n  # If any pass reads an odd number of 0s (a remainder), reject right away.\\n  # Otherwise if every pass halves the length cleanly,\\n  # the length must be a power of two (1*2^n for n  0).\\n\\n  # Note that since the first 0 is never crossed off, we can simply\\n  # erase it on the first pass and start the count from 1 from then on.\\n  table:\\n    zero:\\n      0  : {write: ' ', R: one}\\n      ' ': reject\\n    # Base case: accept length of 1 = 2^0.\\n    one:\\n      0  : {write: x, R: even}\\n      ' ': accept\\n      x  : R\\n    # Inductive case: divide by 2 and check for no remainder.\\n    even:\\n      0  : {R: odd}\\n      ' ': {L: back} # return for another pass\\n      x  : R\\n    odd: # odd and > 1\\n      0  : {write: x, R: even}\\n      ' ': reject # odd number of 0s on this pass\\n      x  : R\\n    back:\\n      ' ': {R: one}\\n      [0,x]: L\\n    accept:\\n    reject:\\npositions:\\n  zero:   {x: 200, y: 200}\\n  one:    {x: 400, y: 200}\\n  even:   {x: 600, y: 200}\\n\\n  odd:    {x: 600, y: 385}\\n  back:   {x: 500, y: 125}\\n  accept: {x: 400, y: 300}\\n  reject: {x: 200, y: 385}\\n\";","module.exports = \"name: repeat 0 1\\nsource code: |\\n  # This is the first example machine given by Alan Turing in his 1936 paper\\n  #   \\\"On Computable Numbers, with an Application to\\n  #    the Entscheidungsproblem\\\".\\n  # It simply writes the endless sequence 0 1 0 1 0 1...\\n  blank: ' '\\n  start state: b\\n  table:\\n    b:\\n      ' ': {write: 0, R: c}\\n    c:\\n      ' ':           {R: e}\\n    e:\\n      ' ': {write: 1, R: f}\\n    f:\\n      ' ':           {R: b}\\n\\n\\n  # (Turing uses the convention of leaving a gap after each output cell,\\n  # reserving it for marking the cell. For instance, on a tape that\\n  # contains '0 1x0 0 1 1y1y0y', x marks the leftmost 1 and y marks 110.)\\npositions:\\n  b: {x: 300, y: 200, fixed: false}\\n  c: {x: 450, y: 150, fixed: false}\\n  e: {x: 500, y: 300, fixed: false}\\n  f: {x: 350, y: 350, fixed: false}\\n\";","module.exports = \"name: unary multiplication\\nsource code: |\\n  # Multiplies together two unary numbers separated by a '*'.\\n  # (Unary is like tallying. Here '||*|||' means 2 times 3.)\\n  input: '||*|||' # try '*', '|*|||', '||||*||'\\n  blank: ' '\\n\\n  # The idea:\\n  #   multiply(0, b) = 0\\n  #   multiply(a, b) = b + multiply(a-1, b)   when a > 0\\n  start state: eachA\\n  table:\\n    # For each 1 in a, add a copy of b.\\n    eachA:\\n      '|': {write: ' ', R: toB}  # Inductive case: a > 0.\\n      '*': {R: skip}             # Base case:      a = 0.\\n    toB:\\n      '|': R\\n      '*': {R: eachB} # enter copier\\n    nextA: # return from copier\\n      ' ': {write: '|', R: eachA}\\n      ['|','*']: L\\n\\n    skip:\\n      '|': R\\n      ' ': {R: done}\\n    done:\\n\\n    # This is the 'copy 1s' machine, with ' ' as 0 and '|' as 1.\\n    eachB:\\n      ' ': {L: nextA}\\n      '|': {write: ' ', R: sep}\\n    sep:\\n      ' ': {R: add}\\n      '|': R\\n    add:\\n      ' ': {write: '|', L: sepL}\\n      '|': R\\n    sepL:\\n      ' ': {L: nextB}\\n      '|': L\\n    nextB:\\n      ' ': {write: '|', R: eachB}\\n      '|': L\\n\\npositions:\\n  eachA:  {x: 400, y:  50}\\n  toB:    {x: 400, y: 150}\\n  eachB:  {x: 400, y: 250}\\n  sep:   {x: 400, y: 350}\\n  add:   {x: 400, y: 450}\\n\\n  sepL:  {x: 280, y: 350}\\n  nextB:  {x: 280, y: 250}\\n\\n  nextA:  {x: 280, y: 90}\\n  skip:   {x: 520, y: 90}\\n  done:   {x: 520, y: 190}\\n\";","'use strict';\n\n/* global document */\nconst { KeyValueStorage } = require('./storage');\nconst TMDocument = require('./TMDocument');\nconst d3 = require('d3');\nconst { defaults } = require('lodash/fp'); // NB. 2nd arg takes precedence\n\n/**\n * Document menu controller.\n *\n * The view is fully determined by a 3-tuple: ([ID], ID -> Name, currentID).\n * @constructor\n * @param {Object}  args                  argument object\n * @param {HTMLSelectElement}\n *                  args.menu\n * @param {?Node}  [args.group=args.menu] Node to add documents to.\n * @param {string}  args.storagePrefix\n * @param {?(TMDocument -> HTMLOptionElement)}\n *                  args.makeOption       Customize rendering for each document entry.\n * @param {?string} args.firsttimeDocID   Document to open on the first visit.\n */\nclass DocumentMenu {\n  constructor(args) {\n    const { menu, storagePrefix, firsttimeDocID } = args;\n    const group = args.group || menu;\n\n    if (!menu) {\n      throw new TypeError('DocumentMenu: missing parameter: menu element');\n    } else if (!storagePrefix) {\n      throw new TypeError('DocumentMenu: missing parameter: storage prefix');\n    }\n    if (args.makeOption) {\n      this.optionFromDocument = args.makeOption;\n    }\n    this.menu = menu;\n    this.group = group;\n    this.group.innerHTML = '';\n    this.__storagePrefix = storagePrefix;\n\n    // Load document entries (non-examples)\n    this.doclist = new DocumentList(storagePrefix + '.list');\n    this.render();\n    // Re-open last-opened document\n    this.selectDocID(this.getSavedCurrentDocID() || firsttimeDocID);\n\n    // Listen for selection changes\n    const self = this;\n    this.menu.addEventListener('change', () => {\n      self.onChange(self.currentDocument, {type: 'open'});\n    });\n\n    // Listen for storage changes in other tabs/windows\n    KeyValueStorage.addStorageListener(e => {\n      let docID;\n      let option;\n      let newOption;\n\n      if (e.key === self.doclist.storageKey) {\n        // case: [ID] list changed\n        self.doclist.readList();\n        self.render();\n      } else if ( (docID = TMDocument.IDFromNameStorageKey(e.key)) ) {\n        // case: single document renamed: (ID -> Name) changed\n        option = self.findOptionByDocID(docID);\n        if (option) {\n          // replace the whole <option>, to be consistent with .optionFromDocument\n          option.parentNode.replaceChild(\n            newOption = self.optionFromDocument(new TMDocument(docID)),\n            option\n          );\n          newOption.selected = option.selected;\n          d3.select(newOption).datum( d3.select(option).datum() );\n        }\n      }\n    });\n  }\n\n  render() {\n    const currentDocID = this.currentOption ? this.currentOption.value : null;\n\n    const option = d3.select(this.group).selectAll('option')\n      .data(this.doclist.list, entry => { return entry.id; });\n\n    option.exit().remove();\n\n    const self = this;\n    option.enter().insert(entry => {\n      return self.optionFromDocument(new TMDocument(entry.id));\n    });\n\n    // If current document was deleted, switch to another document\n    if (this.currentOption.value !== currentDocID) {\n      // fallback 1: saved current docID\n      if (!this.selectDocID(this.getSavedCurrentDocID(), {type: 'delete'})) {\n        // fallback 2: whatever is now selected\n        this.onChange(this.currentDocument, {type: 'delete'});\n      }\n    }\n  }\n\n  // Returns the <option> whose 'value' attribute is docID.\n  findOptionByDocID(docID) {\n    return this.menu.querySelector('option[value=\"' + docID.replace(/\"/g, '\\\\\"') + '\"]');\n  }\n\n  // Selects (switches the active item to) the given docID. Returns true on success.\n  selectDocID(docID, opts) {\n    try {\n      this.findOptionByDocID(docID).selected = true;\n    } catch (e) {\n      return false;\n    }\n    this.onChange(this.currentDocument, opts);\n    return true;\n  }\n\n  // Saves the current (selected) docID to storage.\n  saveCurrentDocID() {\n    const docID = this.currentOption && this.currentOption.value;\n    if (docID) {\n      KeyValueStorage.write(this.__storagePrefix + '.currentDocID', docID);\n    }\n  }\n\n  // Returns the saved current docID, otherwise null.\n  getSavedCurrentDocID() {\n    return KeyValueStorage.read(this.__storagePrefix + '.currentDocID');\n  }\n\n  // Configurable methods\n\n  optionFromDocument(doc) {\n    const option = document.createElement('option');\n    option.value = doc.id;\n    option.text = doc.name || 'untitled';\n    return option;\n  }\n\n  // Called when the current document ID changes\n  // through user action (<select>) or this class's API.\n  // The callback receives the new value of .currentDocument,\n  // along with the options object (whose .type\n  // is 'duplicate', 'delete', or 'open').\n  onChange() {\n  }\n\n  // Internal Helpers\n\n  // prepend then select\n  __prepend(doc, opts) {\n    const option = this.optionFromDocument(doc);\n    this.group.insertBefore(option, this.group.firstChild);\n    if (opts && opts.select) {\n      this.menu.selectedIndex = option.index;\n      this.onChange(doc, opts);\n    }\n    return doc;\n  }\n\n  // Methods not about Current Document\n\n  newDocument(opts) {\n    return this.__prepend(this.doclist.newDocument(), defaults({type: 'open'}, opts));\n  }\n\n  // Methods about Current Document\n\n  duplicate(doc, opts) {\n    return this.__prepend(this.doclist.duplicate(doc), defaults({type: 'duplicate'}, opts));\n  }\n\n  rename(name) {\n    this.currentDocument.name = name;\n    this.currentOption.text = name;\n  }\n\n  // required invariant: one option is always selected.\n  // returns true if the current entry was removed from the list.\n  delete(opts) {\n    this.currentDocument.delete();\n    const index = this.menu.selectedIndex;\n    const didDeleteEntry = this.doclist.deleteIndex(index);\n    if (didDeleteEntry) {\n      this.currentOption.remove();\n      this.menu.selectedIndex = index;\n      this.onChange(this.currentDocument, defaults({type: 'delete'}, opts));\n    }\n    return didDeleteEntry;\n  }\n}\n\nObject.defineProperties(DocumentMenu.prototype, {\n  currentOption: {\n    get: function () {\n      return this.menu.options[this.menu.selectedIndex];\n    },\n    enumerable: true\n  },\n  currentDocument: {\n    get: function () {\n      const opt = this.currentOption;\n      return opt ? new TMDocument(opt.value) : null;\n    },\n    enumerable: true\n  }\n});\n\n/////////////////////\n// Document List   //\n// (model/storage) //\n/////////////////////\n\n\n// for custom documents.\nclass DocumentList {\n  constructor(storageKey) {\n    this.storageKey = storageKey;\n    this.readList();\n  }\n\n  // internal methods.\n  add(docID) {\n    this.__list.unshift({id: docID});\n    this.writeList();\n  }\n\n  readList() {\n    this.__list = JSON.parse(KeyValueStorage.read(this.storageKey)) || [];\n  }\n\n  writeList() {\n    KeyValueStorage.write(this.storageKey, JSON.stringify(this.__list));\n  }\n\n  newDocument() {\n    const newID = DocumentList.newID();\n    this.add(newID);\n    return new TMDocument(newID);\n  }\n\n  duplicate(doc) {\n    return this.newDocument().copyFrom(doc);\n  }\n\n  /**\n   * Behaves like list.splice(index, 1).\n   * @param  {number} index index of the element to delete\n   * @return {boolean} true if an element was removed, false otherwise (index out of bounds)\n   */\n  deleteIndex(index) {\n    const deleted = this.__list.splice(index, 1);\n    this.writeList();\n    return (deleted.length > 0);\n  }\n}\n\n// () -> string\nDocumentList.newID = () => {\n  return String(Date.now());\n};\n\nObject.defineProperties(DocumentList.prototype, {\n  list: {\n    get: function () { return this.__list; },\n    enumerable: true\n  }\n});\n\nmodule.exports = DocumentMenu;\n","'use strict';\n\nconst { KeyValueStorage } = require('./storage');\nconst examples = require('./examples');\nconst util = require('./util');\nconst _ = require('lodash/fp');\n\n/**\n * Document model (storage).\n * @param {string} docID Each document ID in a key-value store should be unique.\n *                       An ID is typically a timestamp. It should not contain '.'.\n */\nclass TMDocument {\n  constructor(docID) {\n    const preset = examples.get(docID);\n    Object.defineProperties(this, {\n      id:     { value: docID },\n      prefix: { value: 'doc.' + docID },\n      isExample: { value: preset ? true : false }\n    });\n    // fall back to reading presets for example documents\n    if (preset) {\n      Object.defineProperties(this, {\n        sourceCode: useFallbackGet(preset, this, 'sourceCode'),\n        // names are read-only\n        positionTable: useFallbackGet(preset, this, 'positionTable'),\n        name: {\n          get: function () { return preset.name; },\n          set: function () {}, // don't err when removing (set = null)\n          enumerable: true\n        }\n      });\n    }\n  }\n\n  // internal method.\n  path(path) {\n    return [this.prefix, path].join('.');\n  }\n\n  // IDEA: bypass extra parse & stringify cycle for positions\n  copyFrom(other) {\n    this.dataKeys.forEach(function (key) {\n      this[key] = other[key];\n    }, this);\n    return this;\n  }\n\n  delete() {\n    this.copyFrom({});\n  }\n}\n\nfunction useFallbackGet(preset, obj, prop) {\n  const proto = Object.getPrototypeOf(obj);\n  const desc = Object.getOwnPropertyDescriptor(proto, prop);\n  const { get } = desc;\n  desc.get = () => {\n    return util.coalesce(get.call(obj), preset[prop]);\n  };\n  return desc;\n}\n\n(() => {\n  const store = KeyValueStorage;\n  const read = store.read.bind(store);\n  const write = (key, val) => {\n    if (val != null) {\n      store.write(key, val);\n    } else {\n      store.remove(key);\n    }\n  };\n  // var remove = store.remove.bind(store);\n  function stringProp(path) {\n    return {\n      get: function () { return read(this.path(path)); },\n      set: function (val) { write(this.path(path), val); },\n      enumerable: true\n    };\n  }\n\n  const propDescriptors = {\n    sourceCode: stringProp('diagram.sourceCode'),\n    positionTable: {\n      get: function () {\n        return util.applyMaybe(parsePositionTable,\n          read(this.path('diagram.positions')));\n      },\n      set: function (val) {\n        write(this.path('diagram.positions'),\n          util.applyMaybe(stringifyPositionTable, val));\n      },\n      enumerable: true\n    },\n    editorSourceCode: stringProp('editor.sourceCode'),\n    name: stringProp('name')\n  };\n  Object.defineProperties(TMDocument.prototype, propDescriptors);\n  TMDocument.prototype.dataKeys = Object.keys(propDescriptors);\n})();\n\n// Cross-tab/window storage sync\n\n/**\n * Checks whether a storage key is for a document's name.\n * @return {?string} The document ID if true, otherwise null.\n */\nTMDocument.IDFromNameStorageKey = string => {\n  const result = /^doc\\.([^.]+)\\.name$/.exec(string);\n  return result && result[1];\n};\n\n/**\n * Registers a listener for document changes caused by other tabs/windows.\n * The listener receives the document ID and the property name that changed.\n * @param {Function} listener\n */\nTMDocument.addOutsideChangeListener = listener => {\n  const re = /^doc\\.([^.]+)\\.(.+)$/;\n\n  KeyValueStorage.addStorageListener(e => {\n    const matches = re.exec(e.key);\n    if (matches) {\n      listener(matches[1], matches[2]);\n    }\n  });\n};\n\n/////////////////////////\n// Position table JSON //\n/////////////////////////\n\n// JSON -> Object\nvar parsePositionTable = JSON.parse;\n\n// PositionTable -> JSON\nvar stringifyPositionTable = _.flow(\n  _.mapValues(truncateCoords(2)),\n  JSON.stringify\n);\n\n// Truncate .x .y .px .py to 2 decimal places, to save space.\nfunction truncateCoords(decimalPlaces) {\n  const multiplier = Math.pow(10, decimalPlaces);\n  function truncate(value) {\n    return Math.round(value * multiplier)/multiplier;\n  }\n\n  return val => {\n    const result =  _(val).pick(['x','y','px','py']).mapValues(truncate).value();\n    result.fixed = val.fixed;\n    return result;\n  };\n}\n\nmodule.exports = TMDocument;\n","'use strict';\nconst TMSimulator = require('./TMSimulator');\nconst parser = require('./parser');\nconst util = require('./util');\nconst ace = require('ace-builds/src-min-noconflict');\nconst d3 = require('d3');\nconst { TMSpecError, YAMLException } = parser;\nconst { UndoManager } = ace.require('ace/undomanager');\n\n/**\n * For editing and displaying a TMDocument.\n * The controller coordinates the interactions between\n *   1. simulator\n *   2. code editor\n *   3. storage\n *\n * All container and button params are required.\n * @param {Object} containers\n *   Empty containers to use (contents will likely be replaced).\n * @param {HTMLDivElement} containers.simulator\n * @param {HTMLDivElement} containers.editorAlerts\n * @param {HTMLDivElement} containers.editor\n * @param {Object} buttons Buttons to use.\n * @param {HTMLButtonElement} buttons.simulator.run\n * @param {HTMLButtonElement} buttons.simulator.step\n * @param {HTMLButtonElement} buttons.simulator.reset\n * @param {HTMLButtonElement} buttons.editor.load For loading the editor source\n * @param {HTMLButtonElement} buttons.editor.revert For reverting the editor source\n * @param {TMDocument} document The document to load from and save to.\n */\nclass TMDocumentController {\n  constructor(containers, buttons, document) {\n    this.simulator = new TMSimulator(containers.simulator, buttons.simulator);\n\n    // Set up ace editor //\n    const editor = ace.edit(containers.editor);\n    editor.session.setOptions({\n      mode: 'ace/mode/yaml',\n      tabSize: 2,\n      useSoftTabs: true\n    });\n    editor.setOptions({\n      minLines: 15,\n      maxLines: 50\n    });\n    // suppress warning about\n    // \"Automatically scrolling cursor into view after selection change\"\n    editor.$blockScrolling = Infinity;\n\n    const editorButtons = buttons.editor;\n    const self = this;\n    editorButtons.load\n      .addEventListener('click', () => {\n        self.loadEditorSource();\n        // save whenever \"Load\" is pressed\n        self.save();\n        self.editor.focus();\n      });\n    editorButtons.revert\n      .addEventListener('click', () => {\n        self.revertEditorSource();\n        self.editor.focus();\n      });\n\n    Object.defineProperties(this, {\n      __document: {\n        value: {editor: {}}, // dummy document that gets replaced\n        writable: true\n      },\n      buttons   : { value: buttons },\n      containers: { value: containers },\n      editor    : { value: editor, enumerable: true }\n    });\n    this.openDocument(document);\n  }\n\n  getDocument() {\n    return this.__document;\n  }\n\n  // set the backing document, without saving/loading or affecting the views.\n  setBackingDocument(doc) {\n    this.__document = doc;\n  }\n\n  // save the current document, then open another one.\n  // does nothing if the document ID is the same.\n  openDocument(doc) {\n    if (this.getDocument().id === doc.id) { return; } // same document\n    this.save();\n    return this.forceLoadDocument(doc);\n  }\n\n  // (low-level) load the document. current data is discarded without saving.\n  // this can be used to switch from a deleted document or reload a document.\n  forceLoadDocument(doc, keepUndoHistory) {\n    this.setBackingDocument(doc);\n    const diagramSource = doc.sourceCode;\n    const editorSource = doc.editorSourceCode;\n    // init //\n    this.simulator.clear();\n    this.setEditorValue(editorSource == null ? diagramSource : editorSource);\n    // prevent undo-ing to the previous document. note: .reset() doesn't work\n    if (!keepUndoHistory) {\n      this.editor.session.setUndoManager(new UndoManager());\n    }\n\n    if (editorSource == null) {\n      // case: synced: load straight from editor.\n      this.loadEditorSource();\n    } else {\n      // case: not synced: editor has separate contents.\n      this.isSynced = false;\n      try {\n        this.simulator.sourceCode = diagramSource;\n        this.simulator.positionTable = doc.positionTable;\n      } catch (e) {\n        this.showCorruptDiagramAlert(true);\n      }\n    }\n  }\n\n  save() {\n    const doc = this.getDocument();\n    if (this.hasValidDiagram) {\n      // sidenote: deleting first can allow saving when space would otherwise be full\n      doc.editorSourceCode = this.isSynced ? undefined : this.editor.getValue();\n      doc.sourceCode = this.simulator.sourceCode;\n      doc.positionTable = this.simulator.positionTable;\n    } else {\n      if (doc.editorSourceCode == null) {\n        // case 1: editor was synced with the diagram.\n        //  only edit doc.sourceCode until it's fixed;\n        //  don't worsen the problem to case 2.\n        doc.sourceCode = this.editor.getValue();\n      } else {\n        // case 2: editor has separate contents.\n        //  this is more confusing, as there are two \"source code\" values to contend with.\n        doc.editorSourceCode = this.editor.getValue();\n      }\n    }\n  }\n\n  /**\n   * Set the editor contents.\n   *  Converts null to '', since editor.setValue(null) crashes.\n   *  Clears the editor alerts.\n   * @param {?string} str\n   */\n  setEditorValue(str) {\n    this.editor.setValue(util.coalesce(str, ''), -1 /* put cursor at start */);\n    this.setAlertErrors([]);\n  }\n\n  setAlertErrors(errors) {\n    const self = this;\n    const alerts = d3.select(self.containers.editorAlerts).selectAll('.alert')\n      .data(errors, e => { return String(e); }); // key by error description\n\n    alerts.exit().remove();\n\n    alerts.enter()\n      .append('div')\n      .attr('class', 'alert alert-danger')\n      .attr('role', 'alert')\n      .each(/** @this div */ function (e) {\n        const div = d3.select(this);\n        if (e instanceof YAMLException) {\n          const annot = aceAnnotationFromYAMLException(e);\n          const lineNum = annot.row + 1; // annotation lines start at 0; editor starts at 1\n          const { column } = annot;\n          div.append('strong')\n            .text('Syntax error on ')\n            .append('a')\n            .text('line ' + lineNum)\n            .on('click', () => {\n              self.editor.gotoLine(lineNum, column, true);\n              self.editor.focus();\n              // prevent scrolling, especially href=\"#\" scrolling to the top\n              d3.event.preventDefault();\n            })\n            .attr('href', '#' + self.containers.editor.id);\n          div.append('br');\n          // aside: text nodes aren't elements so they need to be wrapped (e.g. in span)\n          // https://github.com/mbostock/d3/issues/94\n          div.append('span').text('Possible reason: ' + e.reason);\n        } else if (e instanceof TMSpecError) {\n          div.html(e.message);\n        } else {\n          div.html('<strong>Unexpected error</strong>: ' + e);\n        }\n      });\n    self.editor.session.setAnnotations(\n      errors\n        .map(e => {\n          return (e instanceof YAMLException) ? aceAnnotationFromYAMLException(e) : null;\n        })\n        .filter(x => { return x; })\n    );\n  }\n\n  //////////////////////////////\n  // Syncing diagram & editor //\n  //////////////////////////////\n\n  // Sync Status\n\n  // This method can be overridden as necessary.\n  // The default implementation toggles Bootstrap 3 classes.\n  setLoadButtonSuccess(didSucceed) {\n    d3.select(this.buttons.editor.load)\n      .classed({\n        'btn-success': didSucceed,\n        'btn-primary': !didSucceed\n      });\n  }\n\n  // internal. whether the editor and diagram source code are in sync, and the diagram is valid.\n  // Updates \"Load machine\" button display.\n  // for future reference: .isSynced cannot be moved to TMDocument because it requires knowledge from the simulator.\n  set isSynced(isSynced) {\n    isSynced = Boolean(isSynced);\n    if (this.__isSynced !== isSynced) {\n      this.__isSynced = isSynced;\n      this.setLoadButtonSuccess(isSynced);\n      if (isSynced) {\n        // changes cause desync\n        const onChange = () => {\n          this.isSynced = false;\n          this.editor.removeListener('change', onChange);\n        };\n        this.editor.on('change', onChange);\n      }\n    }\n  }\n\n  get isSynced() { return this.__isSynced; }\n\n  // public API for isSynced\n  getIsSynced() {\n    return Boolean(this.isSynced);\n  }\n\n  // Load & Revert\n\n  // internal. used to detect when an imported document is corrupted.\n  get hasValidDiagram() {\n    return Boolean(this.simulator.sourceCode);\n  }\n\n  /**\n   * Show/hide the notice that the diagram's source code is invalid;\n   * use this when the editor has contents of its own (so it can't display the diagram's source).\n   *\n   * This happens for imported documents that were corrupted.\n   * It can also happen if the value in storage is tampered with.\n   * @param  {boolean} show true to display immediately, false to hide.\n   */\n  showCorruptDiagramAlert(show) {\n    function enquote(s) { return '<q>' + s + '</q>'; }\n    const div = d3.select(this.simulator.container);\n    if (show) {\n      const revertName = this.buttons.editor.revert.textContent.trim();\n      div.html('')\n        .append('div')\n        .attr('class', 'alert alert-danger')\n        .html('<h4>This imported document has an error</h4>' +\n            [ 'The diagram was not valid and could not be displayed.'\n              , 'You can either load a new diagram from the editor, or attempt to recover this one'\n              , 'using ' + enquote(revertName) + ' (which will replace the current editor contents).'\n            ].join('<br>')\n        );\n    } else {\n      div.selectAll('.alert').remove();\n    }\n  }\n\n  // Sync from editor to diagram\n  loadEditorSource() {\n    // load to diagram, and report any errors\n    const errors = (function () {\n      try {\n        const isNewDiagram = !this.hasValidDiagram;\n        this.simulator.sourceCode = this.editor.getValue();\n        if (isNewDiagram) {\n          // loaded new, or recovery succeeded => close error notice, restore positions\n          this.showCorruptDiagramAlert(false);\n          this.simulator.positionTable = this.getDocument().positionTable;\n        }\n        // .toJSON() is the only known way to preserve the cursor/selection(s)\n        // this.__loadedEditorSelection = this.editor.session.selection.toJSON();\n        return [];\n      } catch (e) {\n        return [e];\n      }\n    }.call(this));\n    this.isSynced = (errors.length === 0);\n    this.setAlertErrors(errors);\n  }\n\n  // Sync from diagram to editor\n  revertEditorSource() {\n    this.setEditorValue(this.hasValidDiagram\n      ? this.simulator.sourceCode\n      : this.getDocument().sourceCode);\n\n    if (this.hasValidDiagram) {\n      this.isSynced = true;\n    } else {\n      // show errors when reverting to a corrupted diagram\n      this.loadEditorSource();\n    }\n    // if (this.__loadedEditorSelection) {\n    //   this.editor.session.selection.fromJSON(this.__loadedEditorSelection);\n    // }\n  }\n}\n\n/////////////////////////\n// Error/Alert Display //\n/////////////////////////\n\nfunction aceAnnotationFromYAMLException(e) {\n  return {\n    row: e.mark.line,\n    column: e.mark.column,\n    text: 'Not valid YAML (possibly caused by a typo):\\n' + e.message,\n    type: 'error'\n  };\n}\n\nmodule.exports = TMDocumentController;\n","'use strict';\n\nconst { parseSpec } = require('./parser');\nconst TMViz = require('./TMViz');\nconst { watchInit } = require('./watch');\nconst { values } = require('lodash');\n\n/**\n * Turing machine simulator component.\n *\n * Contains a state diagram, tape diagram, and button controls.\n * @param {[type]} container [description]\n * @param {[type]} buttons   [description]\n */\nclass TMSimulator {\n  constructor(container, buttons) {\n    this.container = container;\n    this.buttons = buttons;\n\n    const self = this;\n    buttons.step\n      .addEventListener('click', () => {\n        self.machine.isRunning = false;\n        self.machine.step(); // each step click corresponds to 1 machine step\n      });\n    buttons.run\n      .addEventListener('click', () => {\n        self.machine.isRunning = !self.machine.isRunning;\n      });\n    buttons.reset\n      .addEventListener('click', () => {\n        self.machine.reset();\n      });\n    buttons.all = values(buttons);\n\n    this.clear();\n  }\n\n  clear() {\n    this.sourceCode = null;\n  }\n\n  // internal method.\n  rebindButtons() {\n    const { buttons } = this;\n    const enable = (this.machine != null);\n    if (enable) {\n      rebindStepRun(buttons.step, buttons.run,\n        this.htmlForRunButton, this.htmlForPauseButton, this.machine);\n    }\n    buttons.all.forEach(b => { b.disabled = !enable; });\n  }\n}\n\nObject.defineProperties(TMSimulator.prototype, {\n  /**\n   * The machine's source code.\n   *  Setting a new source code will attempt to persist the state node positions.\n   *  To set a new machine, first call .clear(), then set the source code.\n   */\n  sourceCode: {\n    get: function () {\n      return this.__sourceCode;\n    },\n    // throws if sourceCode has errors\n    set: function (sourceCode) {\n      if (this.machine) {\n        this.machine.isRunning = false; // important\n        this.machine.stateviz.force.stop();\n      }\n      if (sourceCode == null) {\n        // clear display\n        this.machine = null;\n        this.container.innerHTML = '';\n      } else {\n        // parse & check, then set\n        const spec = parseSpec(sourceCode);\n        if (this.machine) {\n          // case: update\n          // copy & restore positions, clear & load contents\n          const posTable = this.machine.positionTable;\n          this.clear();\n          this.machine = new TMViz(this.container, spec, posTable);\n        } else {\n          // case: load new\n          this.machine = new TMViz(this.container, spec);\n        }\n      }\n      this.__sourceCode = sourceCode;\n    },\n    enumerable: true\n  },\n  positionTable: {\n    get: function () {\n      return this.machine && this.machine.positionTable;\n    },\n    set: function (posTable) {\n      if (this.machine && posTable) {\n        this.machine.positionTable = posTable;\n      }\n    },\n    enumerable: true\n  },\n  machine: {\n    get: function () {\n      return this.__machine;\n    },\n    set: function (machine) {\n      this.__machine = machine;\n      this.rebindButtons();\n    }\n  }\n});\n\n/////////////\n// Buttons //\n/////////////\n\n/**\n * The innerHTML for the \"Run\" button.\n * The default value can be overridden.\n * @type {string}\n */\nTMSimulator.prototype.htmlForRunButton =\n  '<span class=\"glyphicon glyphicon-play\" aria-hidden=\"true\"></span><br>Run';\nTMSimulator.prototype.htmlForPauseButton =\n  '<span class=\"glyphicon glyphicon-pause\" aria-hidden=\"true\"></span><br>Pause';\n\n// bind: .disabled for Step and Run, and .innerHTML (Run/Pause) for Run\nfunction rebindStepRun(stepButton, runButton, runHTML, pauseHTML, machine) {\n  function onHaltedChange(isHalted) {\n    stepButton.disabled = isHalted;\n    runButton.disabled = isHalted;\n  }\n  function onRunningChange(isRunning) {\n    runButton.innerHTML = isRunning ? pauseHTML : runHTML;\n  }\n  watchInit(machine, 'isHalted', (prop, oldval, isHalted) => {\n    onHaltedChange(isHalted);\n    return isHalted;\n  });\n  watchInit(machine, 'isRunning', (prop, oldval, isRunning) => {\n    onRunningChange(isRunning);\n    return isRunning;\n  });\n}\n\nmodule.exports = TMSimulator;\n","'use strict';\n\n/**\n * Turing machine visualization component.\n *\n *  Adds running and reset on top of the base Turing machine.\n *  Displays an animated state diagram and tape diagram.\n * Does not include UI elements for controlling the machine.\n *\n * @module\n */\n\nconst { TuringMachine } = require('./TuringMachine');\n\nconst TapeViz = require('./tape/TapeViz');\nconst StateGraph = require('./state-diagram/StateGraph');\nconst StateViz = require('./state-diagram/StateViz');\nconst { watchInit } = require('./watch');\nconst d3 = require('d3');\n\n/**\n * Create an animated transition function.\n * @param  {StateGraph} graph\n * @param  {LayoutEdge -> any} animationCallback\n * @return {(string, string) -> Instruction} Created transition function.\n */\nfunction animatedTransition(graph, animationCallback) {\n  return (state, symbol) => {\n    const tuple = graph.getInstructionAndEdge(state, symbol);\n    if (tuple == null) { return null; }\n\n    animationCallback(tuple.edge);\n    return tuple.instruction;\n  };\n}\n\n/**\n * Default edge animation callback.\n * @param  {{domNode: Node}} edge\n * @return {D3Transition} The animation. Use this for transition chaining.\n */\nfunction pulseEdge(edge) {\n  const edgepath = d3.select(edge.domNode);\n  return edgepath\n    .classed('active-edge', true)\n    .transition()\n    .style('stroke-width', '3px')\n    .transition()\n    .style('stroke-width', '1px')\n    .transition()\n    .duration(0)\n    .each('start', /* @this edge */ function () {\n      d3.select(this).classed('active-edge', false);\n    })\n    .style('stroke', null)\n    .style('stroke-width', null);\n}\n\nfunction addTape(div, spec) {\n  return new TapeViz(div.append('svg').attr('class', 'tm-tape'), 9,\n    spec.blank, spec.input ? String(spec.input).split('') : []);\n}\n\n/* global document */\n\n/**\n * Construct a new state and tape visualization inside a &lt;div&gt;.\n * @constructor\n * @param {HTMLDivElement} div        div to take over and use.\n * @param                  spec       machine specification\n * @param {PositionTable} [posTable]  position table for the state nodes\n */\nclass TMViz {\n  constructor(div, spec, posTable) {\n    div = d3.select(div);\n    const graph = new StateGraph(spec.table);\n    this.stateviz = new StateViz(\n      div,\n      graph.getVertexMap(),\n      graph.getEdges()\n    );\n    if (posTable != undefined) { this.positionTable = posTable; }\n\n    this.edgeAnimation = pulseEdge;\n    this.stepInterval = 100;\n\n    const self = this;\n    // We hook into the animation callback to know when to start the next step (when running).\n    function animateAndContinue(edge) {\n      const transition = self.edgeAnimation(edge);\n      if (self.isRunning) {\n        transition.transition().duration(self.stepInterval).each('end', () => {\n          // stop if machine was paused during the animation\n          if (self.isRunning) { self.step(); }\n        });\n      }\n    }\n\n    this.machine = new TuringMachine(\n      animatedTransition(graph, animateAndContinue),\n      spec.startState,\n      addTape(div, spec)\n    );\n    // intercept and animate when the state is set\n    watchInit(this.machine, 'state', (prop, oldstate, newstate) => {\n      d3.select(graph.getVertex(oldstate).domNode).classed('current-state', false);\n      d3.select(graph.getVertex(newstate).domNode).classed('current-state', true);\n      return newstate;\n    });\n\n    // Sidenote: each \"Step\" click evaluates the transition function once.\n    // Therefore, detecting halting always requires its own step (for consistency).\n    this.isHalted = false;\n    this.counter = 0;\n\n    let isRunning = false;\n    /**\n     * Set isRunning to true to run the machine, and false to stop it.\n     */\n    Object.defineProperty(this, 'isRunning', {\n      configurable: true,\n      get: function () { return isRunning; },\n      set: function (value) {\n        if (isRunning !== value) {\n          isRunning = value;\n          if (isRunning) { this.step(); }\n        }\n      }\n    });\n\n    this.__parentDiv = div;\n    this.__spec = spec;\n\n    let index = 0;\n    document.querySelector('.rules tbody').innerHTML = '';\n    document.querySelector('.states tbody').innerHTML = '';\n    for (let [curState, value] of Object.entries(spec.table)) {\n      if (value === null) {\n        document.querySelector('.rules tbody').innerHTML += `\n          <tr>\n            <td>${++index}</td>\n            <td>${curState}</td>\n            <td></td>\n            <td></td>\n            <td></td>\n            <td></td>\n          </tr>`;\n        continue;\n      }\n      for (let [key, { symbol, move, state }] of Object.entries(value)) {\n        for (let curSymbol of key.split(',')) {\n          document.querySelector('.rules tbody').innerHTML += `\n          <tr>\n            <td>${++index}</td>\n            <td>${curState}</td>\n            <td>${curSymbol}</td>\n            <td>${symbol || curSymbol}</td>\n            <td>${move.toString()}</td>\n            <td>${state || curState}</td>\n          </tr>`;\n        }\n      }\n    }\n  }\n\n  /**\n   * Step the machine immediately and interrupt any animations.\n   */\n  step() {\n    const step = this.machine.step();\n    if (!step) {\n      this.isRunning = false;\n      this.isHalted = true;\n    } else {\n      document.querySelector('.states tbody').innerHTML += `\n      <tr>\n        <td>${++this.counter}</td>\n        <td>${this.machine.tape.toString()}</td>\n        <td>${step.state}</td>\n      </tr>`;\n    }\n  }\n\n  /**\n   * Reset the Turing machine to its starting configuration.\n   */\n  reset() {\n    this.isRunning = false;\n    this.isHalted = false;\n    this.counter = 0;\n    this.machine.state = this.__spec.startState;\n    this.machine.tape.domNode.remove();\n    this.machine.tape = addTape(this.__parentDiv, this.__spec);\n  }\n\n  get positionTable() { return this.stateviz.positionTable; }\n  set positionTable(posTable) { this.stateviz.positionTable = posTable; }\n}\n\nmodule.exports = TMViz;\n","'use strict';\n\n/**\n * Construct a Turing machine.\n * @param {(state, symbol) -> ?{state: state, symbol: symbol, move: direction}}\n *   transition\n *   A transition function that, given *only* the current state and symbol,\n *   returns an object with the following properties: symbol, move, and state.\n *   Returning null/undefined halts the machine (no transition defined).\n * @param {state} startState  The state to start in.\n * @param         tape        The tape to use.\n */\nclass TuringMachine {\n  constructor(transition, startState, tape) {\n    this.transition = transition;\n    this.state = startState;\n    this.tape = tape;\n  }\n\n  toString() {\n    return String(this.state) + '\\n' + String(this.tape);\n  }\n\n  /**\n   * Step to the next configuration according to the transition function.\n   * @return {boolean} true if successful (the transition is defined),\n   *   false otherwise (machine halted)\n   */\n  step() {\n    const instruct = this.nextInstruction;\n    if (instruct == null) { return false; }\n\n    this.tape.write(instruct.symbol);\n    move(this.tape, instruct.move);\n    this.state = instruct.state;\n\n    return instruct;\n  }\n}\n\nObject.defineProperties(TuringMachine.prototype, {\n  nextInstruction: {\n    get: function () { return this.transition(this.state, this.tape.read()); },\n    enumerable: true\n  },\n  isHalted: {\n    get: function () { return this.nextInstruction == null; },\n    enumerable: true\n  }\n});\n\n// Allows for both notational conventions of moving the head or moving the tape\nfunction move(tape, direction) {\n  switch (direction) {\n    case MoveHead.right: tape.headRight(); break;\n    case MoveHead.left:  tape.headLeft();  break;\n    default: throw new TypeError('not a valid tape movement: ' + String(direction));\n  }\n}\nvar MoveHead = Object.freeze({\n  left:  {toString: function () { return 'L'; } },\n  right: {toString: function () { return 'R'; } }\n});\nconst MoveTape = Object.freeze({left: MoveHead.right, right: MoveHead.left});\n\nexports.MoveHead = MoveHead;\nexports.MoveTape = MoveTape;\nexports.TuringMachine = TuringMachine;\n","'use strict';\n\nconst { parseDocument } = require('./sharing/format');\nconst { fromPairs } = require('lodash/fp');\n\n\nfunction requireExample(name) {\n  return require('./examples/' + name + '.yaml');\n}\n\nconst examplePairs = [\n  'repeat01',\n  'binaryIncrement',\n  'divisibleBy3',\n  'copy1s',\n  'divisibleBy3Base10',\n  'matchThreeLengths',\n  'matchBinaryStrings',\n  'palindrome',\n  'busyBeaver3',\n  'busyBeaver4',\n  'powersOfTwo',\n  'lengthMult',\n  'binaryAdd',\n  'unaryMult',\n  'binaryMult'\n].map(id => {\n  // parse each string into a document\n  const doc = parseDocument(requireExample(id));\n  doc.id = id;\n\n  return [id, doc];\n});\nconst examples = Object.freeze(fromPairs(examplePairs));\n\n\nfunction isExampleID(docID) {\n  return {}.hasOwnProperty.call(examples, docID);\n}\n\nfunction get(docID) {\n  return isExampleID(docID) ? examples[docID] : null;\n}\n\nconst list = examplePairs.map(pair => { return pair[1]; });\n\n\nexports.hasID = isExampleID;\nexports.get = get;\nexports.list = list;\nexports.firsttimeDocID = 'binaryIncrement';\nexports.blankTemplate = requireExample('_template');\n","var map = {\n\t\"./_template.yaml\": 9920,\n\t\"./binaryAdd.yaml\": 7492,\n\t\"./binaryIncrement.yaml\": 8580,\n\t\"./binaryMult.yaml\": 4856,\n\t\"./busyBeaver3.yaml\": 1428,\n\t\"./busyBeaver4.yaml\": 1812,\n\t\"./copy1s.yaml\": 6890,\n\t\"./divisibleBy3.yaml\": 7525,\n\t\"./divisibleBy3Base10.yaml\": 1542,\n\t\"./lengthMult.yaml\": 9601,\n\t\"./matchBinaryStrings.yaml\": 3536,\n\t\"./matchThreeLengths.yaml\": 7551,\n\t\"./palindrome.yaml\": 3043,\n\t\"./powersOfTwo.yaml\": 9300,\n\t\"./repeat01.yaml\": 9080,\n\t\"./unaryMult.yaml\": 560\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 8653;","'use strict';\n/**\n * Displays a table of keyboard shortcuts.\n */\n\nconst d3 = require('d3');\n\nfunction identity(x) { return x; }\n\n/**\n * Renders a table, using three layers of list nesting: tbody, tr, td.\n * @param  {[ [[HTML]] ]}     data\n * @param  {HTMLTableElement} table\n * @return {D3Selection}            D3 selection of the <tbody> elements\n */\nfunction renderTable(data, table) {\n  const tbody = d3.select(table).selectAll('tbody')\n    .data(data)\n    .enter().append('tbody');\n\n  const tr = tbody.selectAll('tr')\n    .data(identity)\n    .enter().append('tr');\n\n  tr.selectAll('td')\n    .data(identity)\n    .enter().append('td')\n    .html(identity);\n\n  return tbody;\n}\n\n\n// type Key = string;\n// type KeyList = [Key];\n\n// Key -> Key\nfunction abbreviateKey(key) {\n  switch (key) {\n    case 'Command': return 'Cmd';\n    case 'Option':  return 'Opt';\n    case 'Up':      return '';\n    case 'Down':    return '';\n    case 'Left':    return '';\n    case 'Right':   return '';\n    default:        return key;\n  }\n}\n\n// KeyList -> HTML\nfunction keylistToHTML(keys) {\n  return keys.map(key => {\n    return '<kbd>' + key + '</kbd>';\n  }).join('-');\n}\n\n// Commands -> String -> KeyList\nfunction createGetKeylist(commands) {\n  const { platform } = commands;\n  // workaround: some ace keybindings for Mac use Alt instead of Option\n  const altToOption = platform !== 'mac' ? identity : key => {\n    return (key === 'Alt') ? 'Option' : key;\n  };\n\n  return function getKeylist(name) {\n    return commands.commands[name].bindKey[platform].split('-').map(altToOption);\n  };\n}\n\n\n// Fills a <table> with some default keyboard shortcuts.\nfunction main(commands, table) {\n  const getKeylist = createGetKeylist(commands);\n\n  return renderTable(entries.map(group => {\n    return group.map(d => {\n      return [\n        keylistToHTML(getKeylist(d.name).map(abbreviateKey)),\n        d.desc\n      ];\n    });\n  }), table);\n}\n\nvar entries = [\n  [\n    { name: 'save', desc: 'Load machine<br> <small>Save changes and load the machine.</small>' }\n  ], [\n    { name: 'togglecomment', desc: 'Toggle comment' },\n    { name: 'indent', desc: 'Indent selection' },\n    { name: 'outdent', desc: 'Unindent selection' }\n  ], [\n    { name: 'movelinesup', desc: 'Move line up' },\n    { name: 'movelinesdown', desc: 'Move line down' },\n    { name: 'duplicateSelection', desc: 'Duplicate line/selection' }\n  ], [\n    { name: 'selectMoreAfter', desc: 'Add next occurrence to selection<br> <small>Like a quick find. Useful for renaming things.</small>' },\n    { name: 'find', desc: 'Find' },\n    { name: 'replace', desc: 'Find and Replace' }\n  ]\n];\n\n\nexports.main = main;\n","// main entry point for index.html.\n// important: make sure to coordinate variables and elements between the HTML and JS\n'use strict';\n\n/* eslint-env browser */\nconst TMDocumentController = require('./TMDocumentController');\n\nconst DocumentMenu = require('./DocumentMenu');\nconst examples = require('./examples');\nconst { toDocFragment } = require('./util');\nconst ace = require('ace-builds/src-min-noconflict');\nconst $ = require('jquery'); // for Bootstrap modal dialog events\n\n// load up front so going offline doesn't break anything\n// (for snippet placeholders, used by \"New blank document\")\nace.config.loadModule('ace/ext/language_tools');\n\nfunction getId(id) { return document.getElementById(id); }\n\nfunction addAlertPane(type, html) {\n  getId('diagram-column').insertAdjacentHTML('afterbegin',\n    '<div class=\"alert alert-'+type+' alert-dismissible\" role=\"alert\">' +\n    '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\"></span></button>' +\n    html +\n    '</div>');\n}\n\n\n//////////////////////////\n// Compatibility Checks //\n//////////////////////////\n\n(() => {\n  // Warn when falling back to RAM-only storage\n  // NB. This mainly covers local storage errors and Safari's Private Browsing.\n  if (!require('./storage').canUseLocalStorage) {\n    addAlertPane('info', '<p>Local storage is unavailable. ' +\n      'Your browser could be in Private Browsing mode, or it might not support <a href=\"http://caniuse.com/#feat=namevalue-storage\" target=\"_blank\">local storage</a>.</p>' +\n      '<strong>Any changes will be lost after leaving the webpage.</strong>');\n  }\n\n  // Warn about iOS local storage volatility\n  $(() => {\n    // Detect iOS (http://stackoverflow.com/a/9039885)\n    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;\n    if (isIOS) {\n      getId('misc-tips-list').insertAdjacentHTML('afterbegin',\n        '<li><strong class=\"text-warning\">Important note for iOS</strong>: ' +\n        'iOS saves browser local storage in the cache folder, which is <strong>not backed up</strong>, and is ' +\n        '<q cite=\"https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API#Browser_compatibility\"><strong>subject to occasional clean up</strong>, ' +\n        'at the behest of the OS, typically if space is short.</q></li>');\n    }\n  });\n})();\n\n\n/////////////////////\n// Import & Export //\n/////////////////////\n\nfunction importDocument(obj) {\n  // duplicate data into the menu, then open it.\n  menu.duplicate(obj, {select: true, type: 'open'});\n}\n\n$(() => {\n  // Enable buttons now that handlers are ready\n  $('.tm-needsready').prop('disabled', false);\n\n  // Run import from URL query (if any)\n  const importArgs = {\n    dialogNode: getId('importDialog'),\n    importDocument\n  };\n  require('./sharing/import').runImport(importArgs);\n  // Init import dialog\n  const $importPanel = $('#importPanel');\n  $importPanel.one('show.bs.modal', () => {\n    require('./sharing/import-panel').init({\n      $dialog: $importPanel,\n      gistIDForm: getId('gistIDForm'),\n      importArgs\n    });\n  });\n  // Init export dialog\n  const exportPanel = getId('exportPanel');\n  require('./sharing/export-panel').init({\n    $dialog: $(exportPanel),\n    getCurrentDocument: function () {\n      controller.save(); // IMPORTANT: save changes, otherwise data model is out of date\n      return menu.currentDocument;\n    },\n    getIsSynced: controller.getIsSynced.bind(controller),\n    gistContainer: getId('shareGistContainer'),\n    downloadContainer: getId('exportDownloadContainer'),\n    copyContentsButton: getId('copyContentsButton'),\n    textarea: exportPanel.querySelector('textarea')\n  });\n});\n\n\n///////////////////\n// Document List //\n///////////////////\n\nvar menu = (() => {\n  const select = document.getElementById('tm-doc-menu');\n  // Group: Documents\n  const docGroup = document.createElement('optgroup');\n  docGroup.label = 'Documents';\n  select.appendChild(docGroup);\n  // Group: Examples\n  const exampleGroup = document.createElement('optgroup');\n  exampleGroup.label = 'Examples';\n  exampleGroup.appendChild(toDocFragment(examples.list.map(\n    DocumentMenu.prototype.optionFromDocument)));\n  select.appendChild(exampleGroup);\n\n  return new DocumentMenu({\n    menu: select,\n    group: docGroup,\n    storagePrefix: 'tm.docs',\n    firsttimeDocID: examples.firsttimeDocID\n  });\n})();\n\n\n/////////////////\n// \"Edit\" Menu //\n/////////////////\n\n(() => {\n  menu.onChange = (doc, opts) => {\n    switch (opts && opts.type) {\n      case 'duplicate':\n        controller.setBackingDocument(doc);\n        break;\n      case 'delete':\n        controller.forceLoadDocument(doc);\n        break;\n      default:\n        controller.openDocument(doc);\n    }\n    refreshEditMenu();\n  };\n\n  // Refresh the \"Edit\" menu items depending on document vs. example.\n  var refreshEditMenu = (() => {\n    const renameLink = document.querySelector('[data-target=\"#renameDialog\"]');\n    const deleteLink = document.querySelector('[data-target=\"#deleteDialog\"]');\n    let wasExample;\n    function renameExample() {\n      // duplicate, then rename the duplicate.\n      // how it works: switch to duplicate document ->\n      //   refreshEditMenu() enables rename dialog -> event bubbles up -> dialog opens.\n      // this might be the simplest way; Event.stopPropagation leaves the dropdown hanging.\n      duplicateDocument();\n    }\n\n    return () => {\n      const { isExample } = menu.currentDocument;\n      if (wasExample !== isExample) {\n        if (!isExample) {\n          renameLink.textContent = 'Rename';\n          renameLink.removeEventListener('click', renameExample);\n          renameLink.setAttribute('data-toggle', 'modal');\n          deleteLink.textContent = 'Delete';\n          deleteLink.setAttribute('data-target', '#deleteDialog');\n        } else {\n          renameLink.textContent = 'Rename a copy';\n          renameLink.addEventListener('click', renameExample);\n          renameLink.removeAttribute('data-toggle');\n          deleteLink.textContent = 'Reset this example';\n          deleteLink.setAttribute('data-target', '#resetExampleDialog');\n        }\n        wasExample = isExample;\n      }\n    };\n  })();\n  refreshEditMenu();\n\n  // only swap out the storage backing; don't affect views or undo history\n  function duplicateDocument() {\n    controller.save();\n    menu.duplicate(menu.currentDocument, {select: true});\n  }\n\n  function newBlankDocument() {\n    menu.newDocument({select: true});\n    // load up starter template\n    if (controller.editor.insertSnippet) { // async loaded\n      controller.editor.insertSnippet(examples.blankTemplate);\n      controller.loadEditorSource();\n    }\n  }\n\n  const $renameDialog = $(getId('renameDialog'));\n  [{id: 'tm-doc-action-duplicate', callback: duplicateDocument},\n    {id: 'tm-doc-action-newblank', callback: newBlankDocument}\n  ].forEach(item => {\n    document.getElementById(item.id).addEventListener('click', e => {\n      e.preventDefault();\n      item.callback(e);\n\n      $renameDialog.modal({keyboard: false})\n        .one('hidden.bs.modal', () => {\n          controller.editor.focus();\n        });\n    });\n  });\n})();\n\n\n/////////////\n// Dialogs //\n/////////////\n\n(() => {\n  // Rename\n  const $renameDialog = $(getId('renameDialog'));\n  const renameBox = getId('renameDialogInput');\n  $renameDialog\n    .on('show.bs.modal', () => {\n      renameBox.value = menu.currentOption.text;\n    })\n    .on('shown.bs.modal', () => {\n      renameBox.select();\n    })\n    // NB. remember data-keyboard=\"false\" on the triggering element,\n    // to prevent closing with Esc and causing a save.\n    // remark: an exception thrown on 'hide' prevents the dialog from closing,\n    // so save during 'hidden' instead.\n    .on('hidden.bs.modal', () => {\n      const newName = renameBox.value;\n      if (menu.currentOption.text !== newName) {\n        menu.rename(newName);\n      }\n      renameBox.value = '';\n    });\n  document.getElementById('renameDialogForm').addEventListener('submit', e => {\n    e.preventDefault();\n    $renameDialog.modal('hide');\n  });\n\n  // Delete\n  function deleteDocument() {\n    menu.delete();\n  }\n  document.getElementById('tm-doc-action-delete').addEventListener('click', deleteDocument);\n\n  // Reset Example\n  function discardReset() {\n    menu.delete();\n    // load manually since example stays and selection doesn't change\n    controller.forceLoadDocument(menu.currentDocument);\n  }\n  function saveReset() {\n    menu.duplicate(menu.currentDocument, {select: false});\n    discardReset();\n  }\n  document.getElementById('tm-doc-action-resetdiscard').addEventListener('click', discardReset);\n  document.getElementById('tm-doc-action-resetsave').addEventListener('click', saveReset);\n})();\n\n////////////////\n// Controller //\n////////////////\n\nvar controller = (() => {\n  function getButton(container, type) {\n    return container.querySelector('button.tm-' + type);\n  }\n  const editor = document.getElementById('editor-container');\n  // button containers\n  const sim = document.getElementById('controls-container');\n  const ed = editor.parentNode;\n\n  return new TMDocumentController({\n    simulator: document.getElementById('machine-container'),\n    editorAlerts: document.getElementById('editor-alerts-container'),\n    editor\n  }, {\n    simulator: {\n      run: getButton(sim, 'run'),\n      step: getButton(sim, 'step'),\n      reset: getButton(sim, 'reset')\n    },\n    editor: {\n      load: getButton(ed, 'editor-load'),\n      revert: getButton(ed, 'editor-revert')\n    }\n  }, menu.currentDocument);\n})();\n\ncontroller.editor.setTheme('ace/theme/chrome');\ncontroller.editor.commands.addCommand({\n  name: 'save',\n  bindKey: { mac: 'Cmd-S', win: 'Ctrl-S' },\n  exec: function () {\n    controller.loadEditorSource();\n  }\n});\ncontroller.editor.session.setUseWrapMode(true);\n$(() => {\n  try {\n    require('./kbdshortcuts').main(controller.editor.commands,\n      getId('kbdShortcutTable')\n    );\n  } catch (e) {\n    /* */\n  }\n});\n\nwindow.addEventListener('beforeunload', ev => {\n  try {\n    controller.save();\n    menu.saveCurrentDocID();\n  } catch (error) {\n    addAlertPane('warning',\n      '<h4>The current document could not be saved.</h4>'+\n      '<p>Its likely that the <a href=\"https://en.wikipedia.org/wiki/Web_storage#Storage_size\" target=\"_blank\">local storage quota</a> was exceeded. ' +\n      'Try downloading a copy of this document, then deleting other documents to make space.</p>');\n    return (ev || window.event).returnValue =\n      'There is not enough space left to save the current document.';\n  }\n});\n\n// Keep the current document in sync across tabs/windows\nwindow.addEventListener('blur', () => {\n  // One tab saves the data...\n  controller.save();\n});\n(() => {\n  // ...and the other tab loads it.\n  let isReloading = false;\n  require('./TMDocument').addOutsideChangeListener((docID, prop) => {\n    if (docID === controller.getDocument().id && prop !== 'name' && !isReloading) {\n      // Batch together property changes into one reload\n      isReloading = true;\n      setTimeout(() => {\n        isReloading = false;\n        // Preserve undo history\n        controller.forceLoadDocument(controller.getDocument(), true);\n\n      }, 100);\n    }\n  });\n})();\n\n// For interaction/debugging\nexports.controller = controller;\n","'use strict';\n\nconst TM = require('./TuringMachine');\nconst jsyaml = require('js-yaml');\nconst _ = require('lodash');\n\n/**\n * Thrown when parsing a string that is valid as YAML but invalid\n * as a machine specification.\n *\n * Examples: unrecognized synonym, no start state defined,\n * transitioning to an undeclared state.\n *\n * A readable message is generated based on the details (if any) provided.\n * @param {string} reason  A readable error code.\n *   As an error code, this should be relatively short and not include runtime values.\n * @param {?Object} details Optional details. Possible keys:\n *                          problemValue, state, key, synonym, info, suggestion\n */\nclass TMSpecError extends Error {\n  constructor(reason, details) {\n    super();\n    this.name = 'TMSpecError';\n    this.stack = (new Error()).stack;\n\n    this.reason = reason;\n    this.details = details || {};\n  }\n\n  // generate a formatted description in HTML\n  get message() {\n    const header = this.reason;\n    const { details } = this;\n\n    function code(str) { return '<code>' + str + '</code>'; }\n    function showLoc(state, symbol, synonym) {\n      if (state != null) {\n        if (symbol != null) {\n          return ' in the transition from state ' + code(state) + ' and symbol ' + code(symbol);\n        } else {\n          return ' for state ' + code(state);\n        }\n      } else if (synonym != null) {\n        return ' in the definition of synonym ' + code(synonym);\n      }\n      return '';\n    }\n    const problemValue = details.problemValue ? ' ' + code(details.problemValue) : '';\n    const location = showLoc(details.state, details.symbol, details.synonym);\n    const sentences = ['<strong>' + header + problemValue + '</strong>' + location\n      , details.info, details.suggestion]\n      .filter(_.identity)\n      .map(s => { return s + '.'; });\n    if (location) { sentences.splice(1, 0, '<br>'); }\n    return sentences.join(' ');\n  }\n}\n\n// type TransitionTable = {[key: string]: ?{[key: string]: string} }\n// type TMSpec = {blank: string, start state: string, table: TransitionTable}\n\n// IDEA: check with flow (flowtype.org)\n// throws YAMLException on YAML syntax error\n// throws TMSpecError for an invalid spec (eg. no start state, transitioning to an undefined state)\n// string -> TMSpec\nfunction parseSpec(str) {\n  const obj = jsyaml.safeLoad(str);\n  // check for required object properties.\n  // auto-convert .blank and 'start state' to string, for convenience.\n  if (obj == null) { throw new TMSpecError('The document is empty',\n    {info: 'Every Turing machine requires a <code>blank</code> tape symbol,' +\n    ' a <code>start state</code>, and a transition <code>table</code>'}); }\n  const detailsForBlank = {suggestion:\n    'Examples: <code>blank: \\' \\'</code>, <code>blank: \\'0\\'</code>'};\n  if (obj.blank == null) {\n    throw new TMSpecError('No blank symbol was specified', detailsForBlank);\n  }\n  obj.blank = String(obj.blank);\n  if (obj.blank.length !== 1) {\n    throw new TMSpecError('The blank symbol must be a string of length 1', detailsForBlank);\n  }\n  obj.startState = obj['start state'];\n  delete obj['start state'];\n  if (obj.startState == null) {\n    throw new TMSpecError('No start state was specified',\n      {suggestion: 'Assign one using <code>start state: </code>'});\n  }\n  obj.startState = String(obj.startState);\n  // parse synonyms and transition table\n  checkTableType(obj.table); // parseSynonyms assumes a table object\n  const synonyms = parseSynonyms(obj.synonyms, obj.table);\n  obj.table = parseTable(synonyms, obj.table);\n  // check for references to non-existent states\n  if (!(obj.startState in obj.table)) {\n    throw new TMSpecError('The start state has to be declared in the transition table');\n  }\n\n  return obj;\n}\n\nfunction checkTableType(val) {\n  if (val == null) {\n    throw new TMSpecError('Missing transition table',\n      {suggestion: 'Specify one using <code>table:</code>'});\n  }\n  if (typeof val !== 'object') {\n    throw new TMSpecError('Transition table has an invalid type',\n      {problemValue: typeof val,\n        info: 'The transition table should be a nested mapping from states to symbols to instructions'});\n  }\n}\n\n// (any, Object) -> ?SynonymMap\nfunction parseSynonyms(val, table) {\n  if (val == null) {\n    return null;\n  }\n  if (typeof val !== 'object') {\n    throw new TMSpecError('Synonyms table has an invalid type',\n      {problemValue: typeof val,\n        info: 'Synonyms should be a mapping from string abbreviations to instructions'\n        + ' (e.g. <code>accept: {R: accept}</code>)'});\n  }\n  return _.mapValues(val, (actionVal, key) => {\n    try {\n      return parseInstruction(null, table, actionVal);\n    } catch (e) {\n      if (e instanceof TMSpecError) {\n        e.details.synonym = key;\n        if (e.reason === 'Unrecognized string') {\n          e.details.info = 'Note that a synonym cannot be defined using another synonym';\n        }\n      }\n      throw e;\n    }\n  });\n}\n\n// (?SynonymMap, {[key: string]: string}) -> TransitionTable\nfunction parseTable(synonyms, val) {\n  return _.mapValues(val, (stateObj, state) => {\n    if (stateObj == null) {\n      // case: halting state\n      return null;\n    }\n    if (typeof stateObj !== 'object') {\n      throw new TMSpecError('State entry has an invalid type',\n        {problemValue: typeof stateObj, state,\n          info: 'Each state should map symbols to instructions. An empty map signifies a halting state.'});\n    }\n    return _.mapValues(stateObj, (actionVal, symbol) => {\n      try {\n        return parseInstruction(synonyms, val, actionVal);\n      } catch (e) {\n        if (e instanceof TMSpecError) {\n          e.details.state = state;\n          e.details.symbol = symbol;\n        }\n        throw e;\n      }\n    });\n  });\n}\n\n// omits null/undefined properties\n// (?string, direction, ?string) -> {symbol?: string, move: direction, state?: string}\nfunction makeInstruction(symbol, move, state) {\n  return Object.freeze(_.omitBy({symbol, move, state},\n    x => { return x == null; }));\n}\n\nfunction checkTarget(table, instruct) {\n  if (instruct.state != null && !(instruct.state in table)) {\n    throw new TMSpecError('Undeclared state', {problemValue: instruct.state,\n      suggestion: 'Make sure to list all states in the transition table and define their transitions (if any)'});\n  }\n  return instruct;\n}\n\n// throws if the target state is undeclared (not in the table)\n// type SynonymMap = {[key: string]: TMAction}\n// (SynonymMap?, Object, string | Object) -> TMAction\nfunction parseInstruction(synonyms, table, val) {\n  return checkTarget(table, (() => {\n    switch (typeof val) {\n      case 'string': return parseInstructionString(synonyms, val);\n      case 'object': return parseInstructionObject(val);\n      default: throw new TMSpecError('Invalid instruction type',\n        {problemValue: typeof val,\n          info: 'An instruction can be a string (a direction <code>L</code>/<code>R</code> or a synonym)'\n            + ' or a mapping (examples: <code>{R: accept}</code>, <code>{write: \\' \\', L: start}</code>)'});\n    }\n  })());\n}\n\nconst moveLeft = Object.freeze({move: TM.MoveHead.left});\nconst moveRight = Object.freeze({move: TM.MoveHead.right});\n\n// case: direction or synonym\nfunction parseInstructionString(synonyms, val) {\n  if (val === 'L') {\n    return moveLeft;\n  } else if (val === 'R') {\n    return moveRight;\n  }\n  // note: this order prevents overriding L/R in synonyms, as that would\n  // allow inconsistent notation, e.g. 'R' and {R: ..} being different.\n  if (synonyms && synonyms[val]) { return synonyms[val]; }\n  throw new TMSpecError('Unrecognized string',\n    {problemValue: val,\n      info: 'An instruction can be a string if it\\'s a synonym or a direction'});\n}\n\n// type ActionObj = {write?: any, L: ?string} | {write?: any, R: ?string}\n// case: ActionObj\nfunction parseInstructionObject(val) {\n  let symbol;\n  let move;\n  let state;\n  if (val == null) { throw new TMSpecError('Missing instruction'); }\n  // prevent typos: check for unrecognized keys\n  (() => {\n    let badKey;\n    if (!Object.keys(val).every(key => {\n      badKey = key;\n      return key === 'L' || key === 'R' || key === 'write';\n    })) {\n      throw new TMSpecError('Unrecognized key',\n        {problemValue: badKey,\n          info: 'An instruction always has a tape movement <code>L</code> or <code>R</code>, '\n        + 'and optionally can <code>write</code> a symbol'});\n    }\n  })();\n  // one L/R key is required, with optional state value\n  if ('L' in val && 'R' in val) {\n    throw new TMSpecError('Conflicting tape movements',\n      {info: 'Each instruction needs exactly one movement direction, but two were found'});\n  }\n  if ('L' in val) {\n    move = TM.MoveHead.left;\n    state = val.L;\n  } else if ('R' in val) {\n    move = TM.MoveHead.right;\n    state = val.R;\n  } else {\n    throw new TMSpecError('Missing movement direction');\n  }\n  // write key is optional, but must contain a char value if present\n  if ('write' in val) {\n    const writeStr = String(val.write);\n    if (writeStr.length === 1) {\n      symbol = writeStr;\n    } else {\n      throw new TMSpecError('Write requires a string of length 1');\n    }\n  }\n  return makeInstruction(symbol, move, state);\n}\n\nexports.TMSpecError = TMSpecError;\nexports.parseSpec = parseSpec;\n// re-exports\nexports.YAMLException = jsyaml.YAMLException;\n","'use strict';\n\n// var d3 = require('d3');\nconst $ = require('jquery'); // for event delegation\n\nfunction identity(x) { return x; }\nfunction head(array) { return array[0]; }\n\n/**\n * A <table> that includes a checkbox in front of each row,\n * and a header checkbox to (de)select all rows.\n * @param {D3Selection<HTMLTableElement>} args.table empty table to use\n * @param {[string]}    [args.headers] column headers\n * @param {[[string]]}  [args.data]    table data\n */\nclass CheckboxTable {\n  constructor(args) {\n    this.table = args.table;\n    this.headerRow = this.table.append('thead').append('tr');\n    this.tbody = this.table.append('tbody');\n    // header checkbox (selects/deselects all checkboxes)\n    const self = this;\n    this.headerCheckbox = this.headerRow\n      .append('th')\n      .attr('class', 'checkbox-cell')\n      .append('input')\n      .attr('type', 'checkbox')\n      .on('click', /* @this checkbox */ function () {\n        self.getCheckboxes().property('checked', this.checked);\n        self.onChange();\n      });\n    $(this.tbody.node()).on('click', 'tr', /* @this tr */ function (e) {\n      // treat whole <tr> as click zone\n      if (e.target.tagName !== 'INPUT') {\n        const box = this.querySelector('input[type=\"checkbox\"]');\n        box.checked = !box.checked;\n      }\n      // update header checkbox\n      self.refresh();\n      self.onChange();\n    });\n    // content\n    args.headers && this.setHeaders(args.headers);\n    args.data && this.setData(args.data);\n  }\n\n  /**\n   * Set the column headers.\n   * @param {[string]} headers\n   */\n  setHeaders(headers) {\n    const th = this.headerRow\n      .selectAll('th:not(.checkbox-cell)')\n      .data(headers);\n    th.exit().remove();\n    th.enter().append('th');\n    th.text(identity);\n  }\n\n  /**\n   * Set the table body data.\n   *\n   * Each row begins with a checkbox whose .value is the first cell.\n   * Rows are keyed by the first cell when updating data.\n   * @param {[[string]]} data\n   * @return this\n   */\n  setData(data) {\n    const tr = this.tbody.selectAll('tr')\n      .data(data, head);\n    tr.exit().remove();\n    tr.enter()\n      .append('tr')\n    // checkbox at the start of each row\n      .append('td')\n      .attr('class', 'checkbox-cell')\n      .append('input')\n      .attr({\n        type: 'checkbox',\n        value: head\n      });\n    tr.order();\n    // row cells\n    const td = tr.selectAll('td:not(.checkbox-cell)')\n      .data(identity);\n    td.exit().remove();\n    td.enter().append('td');\n    td.text(identity);\n\n    return this;\n  }\n\n  getCheckboxes() {\n    return this.tbody.selectAll('input[type=\"checkbox\"]');\n  }\n\n  getCheckedValues() {\n    return this.tbody.selectAll('input[type=\"checkbox\"]:checked')[0]\n      .map(x => { return x.value; });\n  }\n\n  isCheckedEmpty() {\n    const headerBox = this.headerCheckbox.node();\n    return !(headerBox.checked || headerBox.indeterminate);\n  }\n\n  /**\n   * Refresh the header checkbox (called after a row checkbox is toggled).\n   */\n  refresh() {\n    const headerBox = this.headerCheckbox.node();\n    const boxes = this.getCheckboxes();\n\n    const total = boxes.size();\n    const checked = boxes.filter(':checked').size();\n    if (checked === 0) {\n      headerBox.checked = false;\n    } else if (checked === total) {\n      headerBox.checked = true;\n    }\n    headerBox.indeterminate = (0 < checked && checked < total);\n  }\n\n  // configurable. called after a click toggles a row or header checkbox.\n  onChange() {\n  }\n}\n\nmodule.exports = CheckboxTable;\n","'use strict';\n\n/* global FileReader:false */\nconst Promise = require('bluebird'); // eslint-disable-line no-shadow\n\n// arguments are forwarded to FileReader.readAsText\n// (Blob, ?encoding) -> Promise\nfunction readAsText() {\n  const args = arguments;\n  return new Promise((resolve, reject, onCancel) => {\n    const reader = new FileReader();\n    reader.addEventListener('load', () => {\n      resolve(reader.result);\n    });\n    reader.addEventListener('error', () => {\n      reject(reader.error);\n    });\n    onCancel && onCancel(() => {\n      try { reader.abort(); } catch (e) {/* */}\n    });\n\n    reader.readAsText.apply(reader, args);\n  });\n}\n\nexports.readAsText = readAsText;\n","'use strict';\n\n/* eslint-env browser */\nconst format = require('./format');\nconst { createGist } = require('./gist');\nconst Clipboard = require('clipboard');\nconst $ = require('jquery'); // for bootstrap tooltip\n\n// https://github.com/Modernizr/Modernizr/blob/master/feature-detects/a/download.js\nconst canUseDownloadAttribute =\n  !window.externalHost && 'download' in document.createElement('a');\n\n// can copy to clipboard programmatically?\nconst canUseCopyCommand = (() => {\n  try {\n    return document.queryCommandSupported('copy');\n  } catch (e) {\n    return false;\n  }\n})();\n\n// Add event handlers to select an HTMLInputElement's text on focus.\nfunction addSelectOnFocus(element) {\n  element.addEventListener('focus', function selectAll(e) {\n    e.target.select();\n  });\n  // Safari workaround\n  element.addEventListener('mouseup', e => {\n    e.preventDefault();\n  });\n}\n\n// Show a one-time tooltip.\n// NB. an existing title attribute overrides the tooltip options.\nfunction showTransientTooltip($element, options) {\n  $element.tooltip(options)\n    .tooltip('show')\n    .one('hidden.bs.tooltip', () => {\n      $element.tooltip('destroy');\n    });\n}\n\nfunction showCopiedTooltip(element) {\n  showTransientTooltip($(element), {title: 'Copied!', placement: 'bottom'});\n}\n\n\n///////////////////////\n// Share with GitHub //\n///////////////////////\n\n/**\n * Generate a new gist and display a shareable link.\n * @param  {HTMLElement} container  Container to use for displaying the link.\n * @param  {HTMLButtonElement} button\n * @param  {string} filename\n * @param  {string} contents  The file contents.\n * @return {Promise}          Cancellable promise to create the gist.\n */\nfunction generateGist(container, button, filename, contents) {\n  const oldButtonText = button.textContent;\n  button.textContent = 'Loading';\n  button.disabled = true;\n\n  const payload = {\n    files: {},\n    description: 'Turing machine for http://turingmachine.io',\n    public: true\n  };\n  payload.files[filename] = {content: contents};\n\n  return createGist(payload).then(response => {\n    // Show link on success\n    const { id } = response;\n    showGeneratedGist(container, 'http://turingmachine.io/?import-gist=' + id);\n  }).catch(reason => {\n    // Alert error on failure\n    const message = (() => {\n      const { xhr } = reason;\n      try {\n        return 'Response from GitHub: ' + xhr.responseJSON.message + '';\n      } catch (e) {\n        if (xhr.status > 0) {\n          return 'HTTP status code: ' + xhr.status + ' ' + xhr.statusText;\n        } else {\n          return 'GitHub could not be reached.\\nYour Internet connection may be offline.';\n        }\n      }\n    })();\n    alert('Could not create new gist.\\n\\n' + message);\n\n    button.disabled = false;\n    button.textContent = oldButtonText;\n  });\n}\n\nfunction showGeneratedGist(container, url) {\n  container.innerHTML =\n    '<input id=\"sharedPermalink\" type=\"url\" class=\"form-control\" readonly>' +\n    '<button type=\"button\" class=\"btn btn-default\" data-clipboard-target=\"#sharedPermalink\">' +\n    '<span class=\"glyphicon glyphicon-copy\" aria-hidden=\"true\"></span>' +\n    '</button>';\n  const urlInput = container.querySelector('input');\n  urlInput.value = url;\n  urlInput.size = url.length + 2;\n  addSelectOnFocus(urlInput);\n  urlInput.focus();\n}\n\nfunction createGenerateGistButton(container) {\n  container.innerHTML =\n  '<button type=\"button\" class=\"btn btn-default\">Create permalink</button>' +\n  '<p class=\"help-block\">This will create and link to a new' +\n    ' <a href=\"https://help.github.com/articles/creating-gists/#creating-an-anonymous-gist\"' +\n    ' target=\"_blank\">read-only</a> GitHub gist.' +\n  '</p>';\n  return container.querySelector('button');\n}\n\n\n///////////////////\n// Download file //\n///////////////////\n\n// Create a link button if canUseDownloadAttribute, otherwise a link with instructions.\nfunction createDownloadLink(filename, contents) {\n  const link = document.createElement('a');\n  link.href = 'data:text/x-yaml;charset=utf-8,' + encodeURIComponent(contents);\n  link.target = '_blank';\n  link.download = filename;\n\n  if (canUseDownloadAttribute) {\n    link.textContent = 'Download document';\n    link.className = 'btn btn-primary';\n    return link;\n  } else {\n    link.textContent = 'Right-click here and choose Save target as or Download Linked File As';\n    const p = document.createElement('p');\n    p.innerHTML = ', <br>then name the file to end with <code>.yaml</code>';\n    p.insertBefore(link, p.firstChild);\n    return p;\n  }\n}\n\n\n////////////\n// Common //\n////////////\n\nfunction init(args) {\n  const { $dialog, getCurrentDocument, getIsSynced, gistContainer, downloadContainer, textarea } = args;\n\n  if (canUseDownloadAttribute) {\n    $dialog.addClass('download-attr');\n  }\n  if (!canUseCopyCommand) {\n    $dialog.addClass('no-copycommand');\n  }\n  gistContainer.className = 'form-group form-inline';\n  addSelectOnFocus(textarea);\n\n  function setupDialog() {\n    const doc = getCurrentDocument();\n    const filename = doc.name + '.yaml';\n    const contents = format.stringifyDocument(doc);\n    let gistPromise;\n\n    // warn about unsynced changes\n    let $alert;\n    if (!getIsSynced()) {\n      $alert = $(\n        '<div class=\"alert alert-warning\" role=\"alert\">' +\n        'The code editor has <strong>unsynced changes</strong> and might not correspond with the diagram.<br>' +\n        'Click <q>Load machine</q> to try to sync them. Otherwise, two sets of code will be exported.' +\n        '</div>'\n      ).prependTo($dialog.find('.modal-body'));\n    }\n\n    createGenerateGistButton(gistContainer).addEventListener('click', e => {\n      gistPromise = generateGist(gistContainer, e.target, filename, contents);\n    });\n\n    // \"Download document\" button link\n    downloadContainer.appendChild(createDownloadLink(filename, contents));\n    // <textarea> for document contents\n    textarea.value = contents;\n\n    const clipboard = new Clipboard('[data-clipboard-target]');\n    clipboard.on('success', e => {\n      showCopiedTooltip(e.trigger);\n      e.clearSelection();\n    });\n\n    // return cleanup function\n    return () => {\n      if (gistPromise) {\n        try { gistPromise.cancel(); } catch (e) {/* */}\n      }\n      if ($alert) { $alert.remove(); }\n      gistContainer.textContent = '';\n      downloadContainer.textContent = '';\n      textarea.value = '';\n      clipboard.destroy();\n    };\n  }\n\n  $dialog.on('show.bs.modal', () => {\n    const cleanup = setupDialog();\n    $dialog.one('hidden.bs.modal', cleanup);\n  });\n  $dialog.on('shown.bs.modal', () => {\n    // workaround \"Copy to clipboard\" .focus() scrolling down to <textarea>\n    // note: doesn't work when <textarea> is completely out of view\n    textarea.setSelectionRange(0,0);\n  });\n}\n\nexports.init = init;\n","'use strict';\n\nconst jsyaml = require('js-yaml');\nconst _ = require('lodash/fp');\n\n// Document Serialization\n\nconst docToYaml = {\n  name: 'name',\n  sourceCode: 'source code',\n  positionTable: 'positions',\n  editorSourceCode: 'editor contents'\n};\nconst yamlToDoc = _.invert(docToYaml);\n\n// like _.mapKeys, but only using the keys specified in a mapping object.\n// {[key: string] -> string} -> ?Object -> Object\nfunction mapKeys(mapping) {\n  return input => {\n    const output = {};\n    if (input != null) {\n      Object.keys(mapping).forEach(fromKey => {\n        const toKey = mapping[fromKey];\n        output[toKey] = input[fromKey];\n      });\n    }\n    return output;\n  };\n}\n\n// we want parseDocument . stringifyDocument = identity, up to null == undefined.\n\n/**\n * Serialize a document.\n * For each state node position, only .x, .y, and .fixed are saved.\n * .fixed is omitted if true (its default value).\n * @param  {TMDocument} doc document to serialize\n * @return {string}\n */\nconst stringifyDocument = _.flow(\n  mapKeys(docToYaml),\n  _.omitBy(x => { return x == null; }),\n  _.update('positions', _.mapValues(pos => {\n    return pos.fixed\n      ? {x: pos.x, y: pos.y}\n      : {x: pos.x, y: pos.y, fixed: false};\n  })),\n  // NB. lodash/fp/partialRight takes an array of arguments.\n  _.partialRight(jsyaml.safeDump, [{\n    flowLevel: 2,       // positions: one state per line\n    lineWidth: -1,      // don't wrap lines\n    noRefs: true,       // no aliases/references are used\n    noCompatMode: true  // use y: instead of 'y':\n  }])\n);\n\n/**\n * Deserialize a document.\n * State positions' .px and .py are optional and default to .x and .y.\n * .fixed defaults to true.\n * @param  {string} str    serialized document\n * @return {Object}        data usable in TMDocument.copyFrom()\n * @throws {YAMLException} on YAML syntax error\n * @throws {TypeError}     when missing \"source code\" string property\n */\nconst parseDocument = _.flow(\n  jsyaml.safeLoad,\n  _.update('positions', _.mapValues(pos => {\n    // NB. lodash/fp/defaults is swapped: 2nd takes precedence\n    return _.defaults({px: pos.x, py: pos.y, fixed: true}, pos);\n  })),\n  mapKeys(yamlToDoc),\n  checkData\n);\n\n// throw if \"source code\" attribute is missing or not a string\nfunction checkData(obj) {\n  if (obj == null || obj.sourceCode == null) {\n    throw new InvalidDocumentError('The source code: value is missing');\n  } else if (!_.isString(obj.sourceCode)) {\n    throw new InvalidDocumentError('The source code: value needs to be of type string');\n  }\n  return obj;\n}\n\n// for valid YAML that is not valid as a document\nclass InvalidDocumentError extends Error {\n  constructor(message) {\n    super();\n    this.name = 'InvalidDocumentError';\n    this.message = message || 'Invalid document';\n    this.stack = (new Error()).stack;\n  }\n}\n\nexports.stringifyDocument = stringifyDocument;\nexports.parseDocument = parseDocument;\nexports.InvalidDocumentError = InvalidDocumentError;\n\n// Re-exports\nexports.YAMLException = jsyaml.YAMLException;\n","'use strict';\n\nconst $ = require('jquery');\nconst Promise = require('bluebird'); // eslint-disable-line no-shadow\n\nPromise.config({\n  cancellation: true\n});\n\n// On success, 'resolve' is called with the response data.\n// On failure, 'reject' is called with {xhr: jqXHR, status: string, error: string}.\n// To abort the request, use .cancel (from bluebird). Neither is called in that case.\n// jqXHR -> Promise\nfunction promisifyAjax(xhr) {\n  return new Promise((resolve, reject, onCancel) => {\n    xhr.then(resolve, (jqXHR, textStatus, errorThrown) => {\n      reject({xhr: jqXHR, status: textStatus, error: errorThrown});\n    });\n    onCancel && onCancel(() => {\n      try { xhr.abort(); } catch (e) {/* */}\n    });\n  });\n}\n\n// GistID -> Promise\n// @see promisifyAjax\nfunction getGist(gistID) {\n  return promisifyAjax($.ajax({\n    url: 'https://api.github.com/gists/' + gistID,\n    type: 'GET',\n    dataType: 'json',\n    accepts: 'application/vnd.github.v3+json' // specify API version for stability\n  }));\n}\n\n// https://developer.github.com/v3/gists/#create-a-gist\n// @see promisifyAjax\n// {files: {[filename: string]: {content: string}},\n//  description?: string, public?: boolean} -> Promise\nfunction createGist(payload) {\n  // return Promise.delay(1000, {id: 'offlinetesting'});\n  return promisifyAjax($.ajax({\n    url: 'https://api.github.com/gists',\n    type: 'POST',\n    data: JSON.stringify(payload),\n    // headers: {Authorization: 'token DEVTOKEN'},\n    dataType: 'json', // response datatype\n    accepts: 'application/vnd.github.v3+json' // specify API version for stability\n  }));\n}\n\nexports.getGist = getGist;\nexports.createGist = createGist;\n","'use strict';\n\n/* global document: false */\nconst docimport = require('./import');\nconst format = require('./format');\nconst _ = require('lodash/fp');\nconst d3 = require('d3');\n\n// Init the import panel and attach event handlers\n// {$dialog: jQuery, gistIDForm: HTMLFormElement, importArgs: Object} -> void\nfunction init(args) {\n  const { $dialog, gistIDForm, importArgs } = args;\n\n  function hideDialog() {\n    $dialog.modal('hide');\n    // Workaround needed for opening another modal before a modal is done hiding.\n    // Without this, the <body> scrolls instead of the modal:\n    // modal2.show locks body scroll => modal1.hidden unlocks body scroll\n    // while modal2 is still open.\n    const nextDialog = importArgs.dialogNode;\n    $dialog.one('hidden.bs.modal', () => {\n      if (nextDialog.classList.contains('in')) {\n        document.body.classList.add('modal-open');\n      }\n    });\n  }\n\n  // Panel: From GitHub gist\n  gistIDForm.addEventListener('submit', e => {\n    e.preventDefault();\n    hideDialog();\n\n    const gistID = gistIDForm.querySelector('input[type=\"text\"]').value;\n    docimport.importGist(_.assign({gistID}, importArgs));\n  });\n\n  // Panel: From files\n  (() => {\n    // TODO: factor out element IDs and containers into interface\n    const panelBody = document.querySelector('#importFilesPanel > .panel-body');\n    // <input type=\"file\">\n    const fileInput = panelBody.querySelector('input[type=\"file\"]');\n    const importFilesButton = document.getElementById('importFilesButton');\n    importFilesButton.addEventListener('click', () => {\n      hideDialog();\n      docimport.importLocalFiles(_.assign({files: fileInput.files}, importArgs));\n    });\n    // <textarea>\n    const textarea = panelBody.querySelector('textarea');\n    const importContentsButton = document.getElementById('importContentsButton');\n    importContentsButton.parentNode.style.position = 'relative';\n    importContentsButton.addEventListener('click', e => {\n      if (importDocumentContents(\n        { containers: {status: e.target.parentNode, details: panelBody },\n          importDocument: importArgs.importDocument },\n        textarea.value\n      )) {\n        textarea.select();\n      }\n    });\n  })();\n}\n\n///////////////////////////////\n// Import from pasted string //\n///////////////////////////////\n\n// () -> HTMLButtonElement\nfunction createCloseIcon() {\n  return d3.select(document.createElement('button'))\n    .attr({class: 'close', 'aria-label': 'Close'})\n    .html('<span aria-hidden=\"true\">&times;</span>')\n    .node();\n}\n\n// Show import outcome (success/failure) and error (if any)\n// ({status: HTMLElement, details: HTMLElement}, ?Error) -> void\nfunction showImportContentOutcome(containers, error) {\n  const statusContainer = d3.select(containers.status);\n  const detailsContainer = d3.select(containers.details);\n  statusContainer.selectAll('[role=\"alert\"]').remove();\n  detailsContainer.selectAll('.alert').remove();\n  const status = statusContainer.append('span')\n    .attr({role: 'alert'})\n    .style({\n      position: 'absolute', left: 0, width: '40%', // center between left and button\n      top: '50%', transform: 'translateY(-60%)' // center vertically\n    });\n\n  // () -> string\n  function showErrorDetails() {\n    const details = detailsContainer.append('div')\n      .attr({role: 'alert', class: 'alert alert-danger'})\n      .style('margin-top', '1em');\n    details.append(createCloseIcon)\n      .attr('data-dismiss', 'alert')\n      .on('click', () => {\n        status.remove(); // dismiss details => also dismiss status\n      });\n    if (error instanceof format.YAMLException) {\n      details.append('h4').text('Not valid YAML'); // only \".alert h4\" has margin-top: 0\n      details.append('pre').text(error.message);\n    } else if (error instanceof format.InvalidDocumentError) {\n      details.append('span')\n        .text(error.message.replace(/\\.?$/, '.')); // add period if missing\n    } else {\n      details.append('h4').text('Unexpected error');\n      details.append('pre').text(String(error));\n      return 'Import failed';\n    }\n    return 'Not a valid document';\n  }\n\n  if (error) {\n    const statusSummary = showErrorDetails();\n    status.attr({class: 'text-danger'})\n      .html('<span class=\"glyphicon glyphicon-exclamation-sign\" aria-hidden=\"true\"></span> '\n                + statusSummary);\n  } else {\n    status.attr({class: 'text-success'})\n      .html('<span class=\"glyphicon glyphicon-ok\" aria-hidden=\"true\"></span> '\n                + 'Import succeeded')\n      .transition()\n      .delay(2500)\n      .duration(2000)\n      .style('opacity', 0)\n      .remove();\n  }\n}\n\n// returns true if import succeeded\nfunction importDocumentContents(opts, content) {\n  const { containers, importDocument } = opts;\n\n  const error = (() => {\n    try {\n      importDocument(format.parseDocument(content));\n    } catch (e) {\n      return e;\n    }\n  })();\n  showImportContentOutcome(containers, error);\n  return (error == null);\n}\n\nexports.init = init;\n","'use strict';\n\n/* eslint-env browser */\nconst CheckboxTable = require('./CheckboxTable');\nconst FileReaderPromise = require('./FileReaderPromise');\nconst format = require('./format');\nconst { getGist } = require('./gist');\n\nconst $ = require('jquery');\nconst _ = require('lodash/fp');\nconst d3 = require('d3');\nconst Promise = require('bluebird');  // eslint-disable-line no-shadow\n\n\nfunction decodeFormURLComponent(str) {\n  return decodeURIComponent(str.replace('+', ' '));\n}\n\n/**\n * https://url.spec.whatwg.org/#urlencoded-parsing\n */\nfunction queryParams(queryString) {\n  function decode(str) {\n    return str ? decodeFormURLComponent(str) : '';\n  }\n  const result = {};\n  queryString.split('&').forEach(str => {\n    const pair = str.split('=');\n    result[decode(pair[0])] = decode(pair[1]);\n  });\n  return result;\n}\n\n///////////////////\n// Import Dialog //\n///////////////////\n\n// requires an existing dialog in the DOM\nclass ImportDialog {\n  constructor(dialogNode) {\n    this.node = dialogNode;\n    this.titleNode = dialogNode.querySelector('.modal-header .modal-title');\n    this.bodyNode = dialogNode.querySelector('.modal-body');\n    this.footerNode = dialogNode.querySelector('.modal-footer');\n    this.cancelButtonNode = d3.select(this.footerNode).text('')\n      .append('button')\n      .attr({type: 'button', class: 'btn btn-default', 'data-dismiss': 'modal'})\n      .text('Cancel')\n      .node();\n    this.$dialog = $(dialogNode)\n      .one('hide.bs.modal', this.__onClose.bind(this));\n  }\n\n  // internal event handler.\n  __onClose() {\n    this.onClose();\n    // use .empty to clean up $.on used in CheckboxTable\n    $(this.bodyNode).empty();\n    $(this.footerNode).empty();\n  }\n\n  // configurable\n  onClose() {\n  }\n\n  show() {\n    this.$dialog.modal({backdrop: 'static', keyboard: false});\n  }\n\n  close() {\n    this.$dialog.modal('hide');\n  }\n\n  setBodyChildNodes(nodes) {\n    this.bodyNode.textContent = '';\n    this.bodyNode.appendChild(joinNodes(nodes));\n  }\n}\n\nfunction appendPanel(div, titleHTML) {\n  const panel = div.append('div')\n    .attr('class', 'panel panel-default');\n  panel.append('div')\n    .attr('class', 'panel-heading')\n    .append('h5')\n    .attr('class', 'panel-title')\n    .html(titleHTML);\n  return panel;\n}\n\nconst emptySelection = Object.freeze(d3.selectAll([]));\n\n// (D3Selection, {title: string, data: [string]}) -> void\nfunction appendListPanel(container, data) {\n  let panel = emptySelection;\n  if (data.data && data.data.length) {\n    panel = appendPanel(container, data.title);\n    panel.append('div')\n      .attr('class', 'panel-body')\n      .append('ul')\n      .attr('class', 'list-inline')\n      .selectAll('li')\n      .data(data.data)\n      .enter().append('li')\n      .text(_.identity);\n  }\n  return panel;\n}\n\n// ( D3Selection, {title: string, headers: [string],\n//  data: [[string | (D3Selection -> void)]]} ) -> void\nfunction appendTablePanel(container, data) {\n  let panel = emptySelection;\n  if (data.data && data.data.length) {\n    panel = appendPanel(container, data.title);\n    panel.append('table')\n      .attr('class', 'table')\n      .call(table => {\n        // headers\n        table.append('thead')\n          .append('tr').selectAll('th').data(data.headers)\n          .enter().append('th').text(_.identity);\n        // contents\n        table.append('tbody').selectAll('tr')\n          .data(data.data)\n          .enter().append('tr').selectAll('td')\n          .data(_.identity)\n          .enter().append('td').each(/* @this td */ function (d) {\n            const td = d3.select(this);\n            if (typeof d === 'function') {\n              d(td);\n            } else {\n              td.text(d);\n            }\n          });\n      });\n  }\n  return panel;\n}\n\n// NonDocumentFiles -> boolean\nconst isEmptyNonDocs = _.every(_.isEmpty);\n\n// (D3Selection, NonDocumentFiles, ?string) -> void\nfunction listNondocuments(dialogBody, nondocs, disclosureTitle) {\n  if (isEmptyNonDocs(nondocs)) {\n    return;\n  }\n  // Disclosure triangle\n  const collapseId = 'nondocument-files';\n  dialogBody.append('a')\n    .attr({\n      href: '#'+collapseId,\n      class: 'disclosure-triangle collapsed',\n      role: 'button',\n      'data-toggle': 'collapse'\n    })\n    .text(disclosureTitle ? disclosureTitle : 'Show other files');\n  const container = dialogBody.append('div')\n    .attr({\n      id: collapseId,\n      class: 'collapse'\n    });\n  // Errors by type, most important first\n  appendTablePanel(container, {\n    title: 'Unexpected error',\n    headers: ['Filename', 'Error'],\n    data: nondocs.otherError.map(function functionName(d) {\n      return [d.filename, errorString(d.error) ];\n    })\n  }).classed('panel-danger', true);\n  appendTablePanel(container, {\n    title: 'Not suitable for import',\n    headers: ['Filename', 'Reason'],\n    data: nondocs.badDoc.map(d => {\n      return [d.filename, d.error.message];\n    })\n  });\n  appendTablePanel(container, {\n    title: 'Not valid as YAML',\n    headers: ['Filename', 'Syntax error'],\n    data: nondocs.badYAML.map(d => {\n      return [d.filename,\n        td => { td.append('pre').text(d.error.message); } ];\n    })\n  });\n  // TODO: document largest allowed filesize; limit export likewise\n  appendListPanel(container, {\n    title: 'File is too large',\n    data: nondocs.tooLarge\n  });\n  appendListPanel(container, {\n    title: 'Different file extension (not <code>.yaml</code>/<code>.yml</code>)',\n    data: nondocs.wrongType\n  });\n}\n\n// deal with objects like DOMError (whose .toString gives \"[object FileError]\")\nfunction errorString(reason) {\n  return reason instanceof Error\n    ? String(reason)\n    : reason.message || reason.name || String(reason);\n}\n\n//////////////////////\n// Document Parsing //\n//////////////////////\n\n/* Interface for Document Parsing\n  type GistFile = {\n    filename: string,\n    size: number,\n    truncated: boolean,\n    content: string\n  };\n  type TMData = {source code: string};\n  type DocFile = {filename: string, size: number, document: TMData};\n\n  type Filename = string;\n  type ErrorTuple = {filename: Filename, error: Error | YAMLException};\n  type NonDocumentFiles = {\n    wrongType:  [Filename],\n    tooLarge:   [Filename],\n    badYAML:    [ErrorTuple],\n    badDoc:     [ErrorTuple],\n    otherError: [ErrorTuple]\n  };\n  type ParseResult = {documentFiles: [DocFile], nonDocumentFiles: NonDocumentFiles};\n */\n\n// Parse each file into a document or a categorized error.\n// Local files are read only if they have the right extension and size.\n// NB. make sure to convert FileList to an actual Array.\n// The promise resolves with ParseResult.\n// (number, [GistFile | File]) -> Promise\nfunction parseFiles(sizelimit, files) {\n  const docfiles = [];\n  const nondocs = {wrongType: [], tooLarge: [], badYAML: [], badDoc: [], otherError: []};\n\n  return Promise.each(files, file => {\n    const name = file.filename || file.name; // eslint-disable-line no-shadow\n    if (name.search(/\\.ya?ml$/) === -1) {\n      nondocs.wrongType.push(name);\n    } else if (file.truncated || file.size > sizelimit) {\n      nondocs.tooLarge.push(name);\n    } else {\n      return Promise.resolve(file.content != null ? file.content\n        : FileReaderPromise.readAsText(file))\n        .then(content => {\n          docfiles.push({\n            filename: name,\n            size: file.size,\n            document: format.parseDocument(content)\n          });\n        }).catch(e => {\n          const tuple = {filename: name, error: e};\n          if (e instanceof format.YAMLException) {\n            nondocs.badYAML.push(tuple);\n          } else if (e instanceof format.InvalidDocumentError) {\n            nondocs.badDoc.push(tuple);\n          } else {\n            nondocs.otherError.push(tuple);\n          }\n        });\n    }\n  }).return({documentFiles: docfiles, nonDocumentFiles: nondocs});\n}\n\n/////////////////////\n// Document Import //\n/////////////////////\n\nfunction showSizeKB(n) {\n  // example: 12.0 KB\n  return (Math.ceil(10*n/1024)/10).toFixed(1) + ' KB';\n}\n\n// {docFiles: [DocFile], nonDocumentFiles: NonDocumentFiles,\n//  dialog: ImportDialog, citeNode?: Node, importDocuments: [TMData] -> void} -> void\nfunction pickMultiple(args) {\n  const docfiles = args.documentFiles;\n  const nondocs = args.nonDocumentFiles;\n  const { citeNode, dialog, importDocuments } = args;\n  // Dialog body\n  const dialogBody = d3.select(dialog.bodyNode).text('');\n  dialogBody.append('p').call(p => {\n    p.append('strong').text('Select documents to import');\n    if (citeNode) {\n      p.node().appendChild(document.createTextNode(' from '));\n      p.node().appendChild(citeNode);\n    }\n  });\n  const ctable = new CheckboxTable({\n    table: dialogBody.append('table')\n      .attr({class: 'table table-hover checkbox-table'}),\n    headers: ['Filename', 'Size'],\n    data: docfiles.map(doc => {\n      return [doc.filename, showSizeKB(doc.size)];\n    })\n  });\n  listNondocuments(dialogBody, nondocs);\n  // Dialog footer\n  const importButton = d3.select(dialog.footerNode).append('button')\n    .attr({type: 'button', class: 'btn btn-primary', 'data-dismiss': 'modal'})\n    .property('disabled', true)\n    .text('Import')\n    .on('click', /* @this button */ function () {\n      d3.select(this).on('click', null); // prevent double import; like .one()\n      const names = d3.set(ctable.getCheckedValues());\n      importDocuments(docfiles\n        .filter(file => { return names.has(file.filename); })\n        .map(_.property('document'))\n      );\n    })\n    .node();\n  ctable.onChange = () => {\n    importButton.disabled = ctable.isCheckedEmpty();\n  };\n}\n\n// {nonDocumentFiles: NonDocumentFiles, dialog: ImportDialog, citeLink?: Node} -> void\nfunction pickNone(args) {\n  const nondocs = args.nonDocumentFiles;\n  const { dialog, citeLink } = args;\n\n  d3.select(dialog.bodyNode).text('').call(body => {\n    body.append('p').append('strong').text(!isEmptyNonDocs(nondocs)\n      ? 'None of the files are suitable for import.'\n      : 'No files were selected.');\n    if (citeLink) {\n      body.append('p').text('Requested URL: ').node().appendChild(citeLink);\n    }\n    listNondocuments(body, nondocs, 'Show details');\n  });\n  dialog.cancelButtonNode.textContent = 'Close';\n}\n\n// Intermingle text and nodes.\n// [Node | string] -> DocumentFragment\nfunction joinNodes(nodes) {\n  const result = document.createDocumentFragment();\n  nodes.forEach(node => {\n    if (typeof node === 'string') {\n      result.appendChild(document.createTextNode(node));\n    } else {\n      result.appendChild(node);\n    }\n  });\n  return result;\n}\n\nfunction wrapTag(tagName, node) {\n  const tag = document.createElement(tagName);\n  tag.appendChild(node);\n  return tag;\n}\n\n// Create a link with text <q>`gist description`</q> if given, otherwise gist `gistID`.\n// {gistID: string, description?: string} -> HTMLAnchorElement | HTMLQuoteElement\nfunction gistDescriptionLink(args) {\n  const link = externalLink({\n    href: 'https://gist.github.com/' + args.gistID,\n    textContent: args.description || ('gist ' + args.gistID)\n  });\n  return args.description ? wrapTag('q', link) : link;\n}\n\n// {href: string, textContent?: string} -> HTMLAnchorElement\nfunction externalLink(args) {\n  const link = document.createElement('a');\n  link.href = args.href;\n  link.target = '_blank';\n  link.textContent = args.textContent || args.href;\n  return link;\n}\n\n// The returned promise resolves/cancels when the dialog is closed:\n//  resolves if loading (before import) finished and the user cancelled anyway\n//  cancels if files were still loading and not yet displayed (eg. fetch, parse)\n// ({gistID: string, dialogNode: Node, importDocument: TMData -> void} |\n// {files: FileList, dialogNode: Node, importDocument: TMData -> void}) -> Promise\nfunction importCommon(args) {\n  const { gistID, dialogNode, importDocument } = args;\n\n  const dialog = new ImportDialog(dialogNode);\n  let citeLink;\n  let citeNode;\n  // prevent accidentally exceeding quota\n  const MAX_FILESIZE = 400 * 1024;\n  // Start fetch, show dialog\n  const filesPromise = (() => {\n    if (gistID != null) {\n      dialog.titleNode.textContent = 'Import from GitHub gist';\n      citeLink = externalLink({href: 'https://gist.github.com/' + gistID});\n      dialog.setBodyChildNodes(['Retrieving ', citeLink, '']);\n      return getGist(gistID).then(data => {\n        citeNode = gistDescriptionLink({\n          gistID,\n          description: data.description\n        });\n        dialog.setBodyChildNodes(['Processing ', citeLink, '']);\n        return _.values(data.files);\n      });\n    } else {\n      dialog.titleNode.textContent = 'Import from files';\n      dialog.setBodyChildNodes(['Processing files']);\n      return Promise.resolve(_.toArray(args.files));\n    }\n  })();\n  dialog.show();\n  // Parse, pick, import\n  const promise = filesPromise\n    .then(parseFiles.bind(undefined, MAX_FILESIZE))\n    .then(parsed => {\n      const docfiles = parsed.documentFiles;\n      switch (docfiles.length) {\n        case 0:\n          pickNone({\n            nonDocumentFiles: parsed.nonDocumentFiles,\n            dialog,\n            citeLink\n          });\n          return;\n        case 1:\n          importDocument(docfiles[0].document);\n          dialog.close();\n          return;\n        default:\n          pickMultiple({\n            documentFiles: docfiles,\n            nonDocumentFiles: parsed.nonDocumentFiles,\n            dialog,\n            citeNode,\n            importDocuments: function importDocuments(docs) {\n              docs.concat().reverse().map(importDocument);\n            }\n          });\n      }\n    })\n    .catch(reason => {\n      dialog.setBodyChildNodes([messageForError(reason)]\n        .concat(citeLink ? ['Requested URL: ', citeLink] : [])\n      );\n      dialog.cancelButtonNode.textContent = 'Close';\n    });\n  const waitForDialog = new Promise(resolve => {\n    dialog.onClose = () => {\n      promise.cancel();\n      resolve();\n    };\n  });\n  return promise.return(waitForDialog);\n}\n\n// {gistID: string, dialogNode: Node, importDocument: TMData -> void} -> Promise\nconst importGist = importCommon;\n\n// {files: FileList, dialogNode: Node, importDocument: TMData -> void} -> Promise\nconst importLocalFiles = importCommon;\n\nfunction createElementHTML(tagName, innerHTML) {\n  const element = document.createElement(tagName);\n  element.innerHTML = innerHTML;\n  return element;\n}\n\n// ({xhr: jqXHR} | Error) -> Node\nfunction messageForError(reason) {\n  const { xhr } = reason;\n  if (xhr) {\n    // case: couldn't fetch\n    return createElementHTML('p', (() => {\n      switch (reason.status) {\n        case 'abort':\n          return [''];\n        case 'timeout':\n          return [\n            '<strong>The request timed out.</strong>',\n            'You can check your connection and try again.'\n          ];\n        default:\n        // case: HTTP error\n          if (xhr.status === 404) {\n            return [\n              '<strong>No GitHub gist exists with that ID.</strong>',\n              'Its possible the ID is incorrect, or the gist was deleted.'\n            ];\n          } else if (xhr.status === 0) {\n            return ['GitHub could not be reached. Your Internet connection may be offline.'];\n          } else {\n            return [\n              'The import failed because of a <strong>connection error</strong>.',\n              'HTTP status code: ' + xhr.status + ' ' + xhr.statusText\n            ];\n          }\n      }\n    })().join('<br>'));\n  } else {\n    // case: other error\n    const pre = document.createElement('pre');\n    pre.textContent = errorString(reason);\n    return joinNodes([\n      createElementHTML('p', 'An unexpected error occurred:'), pre]);\n  }\n}\n\n// Import a gist via ?import-gist=gistID and remove the query string from the URL.\n// Call this once the DOM is ready (document.readyState === 'interactive').\n// {dialogNode: Node, importDocument: TMData -> void} -> void\nfunction runImport(args) {\n  function removeQuery() {\n    try {\n      history.replaceState(null, null, location.pathname);\n    } catch (e) {\n      // ignore\n    }\n  }\n\n  const params = queryParams(location.search.substring(1));\n  const gistID = params['import-gist'];\n  if (gistID) {\n    importGist(_.assign({gistID}, args))\n      .finally(removeQuery);\n  }\n}\n\nexports.importGist = importGist;\nexports.importLocalFiles = importLocalFiles;\nexports.runImport = runImport;\n","'use strict';\n\nconst _ = require('lodash');\n\n\n/* Interface\n  type TransitionTable = {\n    [state: string]: ?{\n      [symbol: string]: Instruction\n    }\n  };\n  type Instruction = { state?: string, symbol?: string };\n\n  type DiagramGraph = {\n    [state: string]: {\n      label: string,\n      transitions: ?{\n        [symbol: string]: {\n          instruction: Instruction,\n          edge: LayoutEdge\n        }\n      }\n    }\n  };\n  type LayoutEdge = { source: Object, target: Object, labels: [string] }\n */\n\n/**\n * Use a transition table to derive the graph (vertices & edges) for a D3 diagram.\n * Edges with the same source and target are combined.\n * NB. In addition to single symbols, comma-separated symbols are supported.\n * e.g. symbol string '0,1,,,I' -> symbols [0,1,',','I'].\n */\n// TransitionTable -> DiagramGraph\nfunction deriveGraph(table) {\n  // We need two passes, since edges may point at vertices yet to be created.\n  // 1. Create all the vertices.\n  const graph = _.mapValues(table, (transitions, state) => {\n    return {\n      label: state,\n      transitions\n    };\n  });\n  // 2. Create the edges, which can now point at any vertex object.\n  const allEdges = [];\n  _.forEach(graph, (vertex, state) => {\n\n    vertex.transitions = vertex.transitions && (() => {\n      const stateTransitions = {};\n\n      // Combine edges with the same source and target\n      const cache = {};\n      function edgeTo(target, label) {\n        const edge = cache[target] ||\n          _.tap(cache[target] = {\n            source: vertex,\n            target: graph[target],\n            labels: []\n          }, allEdges.push.bind(allEdges));\n        edge.labels.push(label);\n        return edge;\n      }\n      // Create symbol -> instruction object map\n      _.forEach(vertex.transitions, (instruct, symbolKey) => {\n        // Handle comma-separated symbols.\n        // Recreate array by splitting on ','. Treat 2 consecutive ',' as , ','.\n        const symbols = symbolKey.split(',').reduce((acc, x) => {\n          if (x === '' && acc[acc.length-1] === '') {\n            acc[acc.length-1] = ',';\n          } else {\n            acc.push(x);\n          }\n          return acc;\n        }, []);\n        const target = instruct.state != null ? instruct.state : state;\n        const edge = edgeTo(target, labelFor(symbols, instruct));\n\n        symbols.forEach(symbol => {\n          stateTransitions[symbol] = {\n            // Normalize for execution, but display the less-cluttered original.\n            instruction: normalize(state, symbol, instruct),\n            edge\n          };\n        });\n      });\n\n      return stateTransitions;\n    })();\n\n  });\n\n  return {graph, edges: allEdges};\n}\n\n// Normalize an instruction to include an explicit state and symbol.\n// e.g. {symbol: '1'} normalizes to {state: 'q0', symbol: '1'} when in state q0.\nfunction normalize(state, symbol, instruction) {\n  return _.defaults({}, instruction, {state, symbol});\n}\n\nfunction labelFor(symbols, action) {\n  const rightSide = ((action.symbol == null) ? '' : (visibleSpace(String(action.symbol)) + ','))\n    + String(action.move);\n  return symbols.map(visibleSpace).join(',') + '' + rightSide;\n}\n\n// replace ' ' with ''.\nfunction visibleSpace(c) {\n  return (c === ' ') ? '' : c;\n}\n\n\n/**\n * Aids rendering and animating a transition table in D3.\n *\n *  Generates the vertices and edges (\"nodes\" and \"links\") for a D3 diagram.\n *  Provides mapping of each state to its vertex and each transition to its edge.\n * @param {TransitionTable} table\n */\nclass StateGraph {\n  constructor(table) {\n    const derived = deriveGraph(table);\n    Object.defineProperties(this, {\n      __graph: { value: derived.graph },\n      __edges: { value: derived.edges }\n    });\n  }\n\n  /**\n   * D3 layout \"nodes\".\n   */\n  // StateGraph.prototype.getVertices = function () {\n  //   return _.values(this.__graph);\n  // };\n\n  /**\n   * Returns the mapping from states to vertices (D3 layout \"nodes\").\n   * @return { {[state: string]: Object} }\n   */\n  getVertexMap() {\n    return this.__graph;\n  }\n\n  /**\n   * D3 layout \"links\".\n   */\n  getEdges() {\n    return this.__edges;\n  }\n\n  /**\n   * Look up a state's corresponding D3 \"node\".\n   */\n  getVertex(state) {\n    return this.__graph[state];\n  }\n\n  getInstructionAndEdge(state, symbol) {\n    const vertex = this.__graph[state];\n    if (vertex === undefined) {\n      throw new Error('not a valid state: ' + String(state));\n    }\n\n    return vertex.transitions && vertex.transitions[symbol];\n  }\n}\n\n\nmodule.exports = StateGraph;\n","'use strict';\n\nconst { isBrowserIEorEdge } = require('../util');\nconst d3 = require('d3');\nconst _ = require('lodash/fp');\nconst { assign } = require('lodash'); // need mutable assign()\n\n// *** Arrays as vectors ***\n\n// Add vectors.\n// Note: dimensions are not checked. Missing dimensions become NaN.\nfunction addV(array1, array2) {\n  return array1.map((x, i) => { return x + array2[i]; });\n}\n\nfunction negateV(array) {\n  return array.map(x => { return -x; });\n}\n\nfunction subtractV(array1, array2) {\n  return addV(array1, negateV(array2));\n}\n\n// Scale the vector by a scalar.\nfunction multiplyV(array, scalar) {\n  return array.map(x => { return scalar*x; });\n}\n\n// Vector norm, squared\nfunction normSqV(array) {\n  function sq(x) { return x*x; }\n  function add(x, y) { return x + y; }\n  return array.map(sq).reduce(add, 0);\n}\n\n// Vector norm\nfunction normV(array) { return Math.sqrt(normSqV(array)); }\n\n// Return a copy of the vector rescaled as a unit vector (norm = 1).\nfunction unitV(array) {\n  const n = normV(array);\n  return array.map(x => { return x / n; });\n}\n\n// *** 2D Vectors ***\nfunction angleV(array) {\n  const x = array[0];\n  const y = array[1];\n  return Math.atan2(y, x);\n}\n\nfunction vectorFromLengthAngle(length, angle) {\n  return [Math.cos(angle) * length, Math.sin(angle) * length];\n}\n\n// *** Utilities ***\n\n// Count the directed edges that start at a given node and end at another.\n// Important: each node must have a unique .index property.\n// Example usage:\n// var counts = new EdgeCounter(edges);\n// var edgesFrom2To5 = counts.numEdgesFromTo(2,5);\n// var edgesFrom5to2 = counts.numEdgesFromTo(5,2);\nclass EdgeCounter {\n  constructor(edges) {\n    edges.forEach(function (e) {\n      const key = e.source.index +','+ e.target.index;\n      this[key] = (this[key] || 0) + 1;\n    }, this);\n  }\n\n  numEdgesFromTo(src, target) {\n    return this[String(src)+','+String(target)] || 0;\n  }\n\n  shapeForEdge(e) {\n    if (e.target.index === e.source.index) {\n      return EdgeShape.loop;\n    } else if (this.numEdgesFromTo(e.target.index, e.source.index)) {\n      // has returning edge => arc\n      return EdgeShape.arc;\n    } else {\n      return EdgeShape.straight;\n    }\n  }\n}\n\nconst EdgeShape = Object.freeze({\n  loop: {},     // self-loop: a->a\n  arc: {},      // curved arc: a->b when b->a exists\n  straight: {}  // straight edge: a->b when b->a does not exist\n});\n\n// create a function that will compute an edge's SVG 'd' attribute.\nfunction edgePathFor(nodeRadius, shape, d) {\n  // case: self-loop\n  let loopEndOffset;\n\n  let loopArc;\n  if (shape === EdgeShape.loop) {\n    // start at the top (90), end slightly above the right (15)\n    loopEndOffset = vectorFromLengthAngle(nodeRadius, -15 * Math.PI/180);\n    loopArc = ' a 19,27 45 1,1 ' + loopEndOffset[0] + ',' + (loopEndOffset[1]+nodeRadius);\n    return () => {\n      const x1 = d.source.x;\n      const y1 = d.source.y;\n      return 'M ' + x1 + ',' + (y1-nodeRadius) + loopArc;\n    };\n  }\n  // case: between nodes\n  if (shape === EdgeShape.arc) {\n    // sub-case: arc\n    return () => {\n      // note: p1 & p2 have to be delayed, to access x/y at the time of the call\n      const p1 = [d.source.x, d.source.y];\n      const p2 = [d.target.x, d.target.y];\n      const offset = subtractV(p2, p1);\n      const radius = 6/5*normV(offset);\n      // Note: SVG's y-axis is flipped, so vector angles are negative\n      // relative to standard coordinates (as used in Math.atan2).\n      // Proof: angle(r <cos , -sin >) = angle(r <cos -, sin ->) = -.\n      const angle = angleV(offset);\n      const sep = -Math.PI/2/2; // 90 separation, half on each side\n      const source = addV(p1, vectorFromLengthAngle(nodeRadius, angle+sep));\n      const target = addV(p2, vectorFromLengthAngle(nodeRadius, angle+Math.PI-sep));\n      // IDEA: consider http://www.w3.org/TR/SVG/paths.html#PathDataCubicBezierCommands\n      return (p1[0] <= p2[0])\n        ? 'M '+source[0]+' '+source[1]+' A '+radius+' '+radius+' 0 0,1 '+target[0]+' '+target[1]\n        : 'M '+target[0]+' '+target[1]+' A '+radius+' '+radius+' 0 0,0 '+source[0]+' '+source[1];\n    };\n  } else if (shape === EdgeShape.straight) {\n    return () => {\n      // sub-case: straight line\n      const p1 = [d.source.x, d.source.y];\n      const p2 = [d.target.x, d.target.y];\n      const offset = subtractV(p2, p1);\n      // avoid spurious errors when bounding causes node centers to coincide\n      if (offset[0] === 0 && offset[1] === 0) { return null; }\n\n      const target = subtractV(p2, multiplyV(unitV(offset), nodeRadius));\n      return 'M '+p1[0]+' '+p1[1]+' L '+ target[0] +' '+ target[1];\n    };\n  }\n}\n\nfunction rectCenter(svgrect) {\n  return {x: svgrect.x + svgrect.width/2,\n    y: svgrect.y + svgrect.height/2};\n}\n\nfunction identity(x) { return x; }\nfunction noop() {}\n\nfunction limitRange(min, max, value) {\n  return Math.max(min, Math.min(value, max));\n}\n\n// IE padding hack so that SVG resizes properly.\n// This works across browsers but we only need it for IE.\nconst appendSVGTo = !isBrowserIEorEdge\n  ? div => { return div.append('svg'); }\n  : (div, hwRatio) => {\n    return div\n      .append('div')\n      .style({\n        width: '100%',\n        height: '0',\n        'padding-bottom': (100 * hwRatio) + '%',\n        position: 'relative'\n      })\n      .append('svg')\n      .style({\n        position: 'absolute',\n        top: '0',\n        left: '0'\n      });\n  };\n\n// *** D3 diagram ***\nrequire('./StateViz.css');\n\n// type LayoutNode = {label: string};\n// type StateMap = {[state: string]: LayoutNode};\n\n/**\n * Create a state diagram inside an SVG.\n * Each vertex/edge (node/link) object is also annotated with @.domNode@\n * corresponding to its SVG element.\n *\n * Note: currently, element IDs (e.g. for textPath) will collide if multiple\n * diagrams are on the same document (HTML page).\n * @param  {D3Selection}      container     Container to add the SVG to.\n * @param  {[LayoutNode] | StateMap} nodes  Parameter to D3's force.nodes.\n *   Important: passing a StateMap is recommended when using setPositionTable.\n *   Passing an array will key the state nodes by array index.\n * @param  {[LayoutEdge]}     linkArray     Parameter to D3's force.links.\n */\nclass StateViz {\n  constructor(container, nodes, linkArray) {\n    /* References:\n      [Sticky Force Layout](http://bl.ocks.org/mbostock/3750558) demonstrates\n      drag to position and double-click to release.\n\n      [Graph with labeled edges](http://bl.ocks.org/jhb/5955887) demonstrates\n      arrow edges with auto-rotated labels.\n    */\n\n    /* eslint-disable no-invalid-this */ // eslint is not familiar with D3\n    const w = 800;\n    const h = 500;\n    const linkDistance = 140;\n    const nodeRadius = 20;\n\n    const colors = d3.scale.category10();\n\n    const svg = appendSVGTo(container, h/w);\n    svg.attr({\n      'viewBox': [0, 0, w, h].join(' '),\n      'version': '1.1',\n      ':xmlns': 'http://www.w3.org/2000/svg',\n      ':xmlns:xlink': 'http://www.w3.org/1999/xlink'\n    });\n\n    // Force Layout\n\n    // drag event handlers\n    function dragstart(d) {\n      d.fixed = true;\n      svg.transition()\n        .style('box-shadow', 'inset 0 0 1px gold');\n    }\n    function dragend() {\n      svg.transition()\n        .style('box-shadow', null);\n    }\n    function releasenode(d) {\n      d.fixed = false;\n      force.resume();\n    }\n\n    // set up force layout\n    const nodeArray = nodes instanceof Array ? nodes : _.values(nodes);\n    this.__stateMap = nodes;\n\n    var force = d3.layout.force()\n      .nodes(nodeArray)\n      .links(linkArray)\n      .size([w,h])\n      .linkDistance([linkDistance])\n      .charge([-500])\n      .theta(0.1)\n      .gravity(0.05)\n      .start();\n\n    const drag = force.drag()\n      .on('dragstart', dragstart)\n      .on('dragend', dragend);\n\n    // Edges\n    const edgeCounter = new EdgeCounter(linkArray);\n\n    const edgeselection = svg.selectAll('.edgepath')\n      .data(linkArray)\n      .enter();\n\n    const edgegroups = edgeselection.append('g');\n\n    const labelAbove = (d, i) => { return String(-1.1*(i+1)) + 'em'; };\n    const labelBelow = (d, i) => { return String(0.6+ 1.1*(i+1)) + 'em'; };\n\n    edgegroups.each(function (edgeD, edgeIndex) {\n      const group = d3.select(this);\n      const edgepath = group\n        .append('path')\n        .attr({'class': 'edgepath',\n          'id': 'edgepath'+edgeIndex })\n        .each(function (d) { d.domNode = this; });\n\n      const labels = group.selectAll('.edgelabel')\n        .data(edgeD.labels).enter()\n        .append('text')\n        .attr('class', 'edgelabel');\n      labels.append('textPath')\n        .attr('xlink:href', () => { return '#edgepath'+edgeIndex; })\n        .attr('startOffset', '50%')\n        .text(identity);\n      /* To reduce JS computation, label positioning varies by edge shape:\n          * Straight edges can use a fixed 'dy' value.\n          * Loops cannot use 'dy' since it increases letter spacing\n            as labels get farther from the path. Instead, since a loop's shape\n            is fixed, it allows a fixed translate 'transform'.\n          * Arcs are bent and their shape is not fixed, so neither 'dy'\n            nor 'transform' can be constant.\n            Fortunately the curvature is slight enough that a fixed 'dy'\n            looks good enough without resorting to dynamic translations.\n      */\n      const shape = edgeCounter.shapeForEdge(edgeD);\n      let isFlipped;\n      edgeD.getPath = edgePathFor(nodeRadius, shape, edgeD);\n      switch (shape) {\n        case EdgeShape.straight:\n          labels.attr('dy', labelAbove);\n          edgeD.refreshLabels = () => {\n            // flip edge labels that are upside-down\n            labels.attr('transform', function () {\n              if (edgeD.target.x < edgeD.source.x) {\n                const c = rectCenter(this.getBBox());\n                return 'rotate(180 '+c.x+' '+c.y+')';\n              } else {\n                return null;\n              }\n            });\n          };\n          break;\n        case EdgeShape.arc:\n          edgeD.refreshLabels = () => {\n            const shouldFlip = edgeD.target.x < edgeD.source.x;\n            if (shouldFlip !== isFlipped) {\n              edgepath.classed('reversed-arc', shouldFlip);\n              labels.attr('dy', shouldFlip ? labelBelow : labelAbove);\n              isFlipped = shouldFlip;\n            }\n          };\n          break;\n        case EdgeShape.loop:\n          labels.attr('transform', (d, i) => {\n            return 'translate(' + String(8*(i+1)) + ' ' + String(-8*(i+1)) + ')';\n          });\n          edgeD.refreshLabels = noop;\n          break;\n      }\n    });\n    const edgepaths = edgegroups.selectAll('.edgepath');\n\n    // Nodes\n    // note: nodes are added after edges so as to paint over excess edge lines\n    const nodeSelection = svg.selectAll('.node')\n      .data(nodeArray)\n      .enter();\n\n    const nodecircles = nodeSelection\n      .append('circle')\n      .attr('class', 'node')\n      .attr('r', nodeRadius)\n      .style('fill', (d, i) => { return colors(i); })\n      .each(function (d) { d.domNode = this; })\n      .on('dblclick', releasenode)\n      .call(drag);\n\n    const nodelabels = nodeSelection\n      .append('text')\n      .attr('class', 'nodelabel')\n      .attr('dy', '0.25em') /* dy doesn't work in CSS */\n      .text(d => { return d.label; });\n\n    // Arrowheads\n    const svgdefs = svg.append('defs');\n    svgdefs.selectAll('marker')\n      .data(['arrowhead', 'active-arrowhead', 'reversed-arrowhead', 'reversed-active-arrowhead'])\n      .enter().append('marker')\n      .attr({'id': function (d) { return d; },\n        'viewBox':'0 -5 10 10',\n        'refX': function (d) {\n          return (d.lastIndexOf('reversed-', 0) === 0) ? 0 : 10;\n        },\n        'orient':'auto',\n        'markerWidth':10,\n        'markerHeight':10\n      })\n      .append('path')\n      .attr('d', 'M 0 -5 L 10 0 L 0 5 Z')\n      .attr('transform', d => {\n        return (d.lastIndexOf('reversed-', 0) === 0) ? 'rotate(180 5 0)' : null;\n      });\n\n    const svgCSS =\n      '.edgepath {' +\n      '  marker-end: url(#arrowhead);' +\n      '}' +\n      '.edgepath.active-edge {' +\n      '  marker-end: url(#active-arrowhead);' +\n      '}' +\n      '.edgepath.reversed-arc {' +\n      '  marker-start: url(#reversed-arrowhead);' +\n      '  marker-end: none;' +\n      '}' +\n      '.edgepath.active-edge.reversed-arc {' +\n      '  marker-start: url(#reversed-active-arrowhead);' +\n      '  marker-end: none;' +\n      '}';\n    svg.append('style').each(function () {\n      if (this.styleSheet) {\n        this.styleSheet.cssText = svgCSS;\n      } else {\n        this.textContent = svgCSS;\n      }\n    });\n\n    // Force Layout Update\n    force.on('tick', () => {\n      // Keep coordinates in bounds. http://bl.ocks.org/mbostock/1129492\n      // NB. Bounding can cause node centers to coincide, especially at corners.\n      nodecircles.attr({cx: function (d) { return d.x = limitRange(nodeRadius, w - nodeRadius, d.x); },\n        cy: function (d) { return d.y = limitRange(nodeRadius, h - nodeRadius, d.y); }\n      });\n\n      nodelabels.attr('x', d => { return d.x; })\n        .attr('y', d => { return d.y; });\n\n      edgepaths.attr('d', d => { return d.getPath(); });\n\n      edgegroups.each(d => { d.refreshLabels(); });\n\n      // Conserve CPU when layout is fully fixed\n      if (nodeArray.every(d => { return d.fixed; })) {\n        force.stop();\n      }\n    });\n    this.force = force;\n    /* eslint-enable no-invalid-this */\n  }\n\n  get positionTable() { return getPositionTable(this.__stateMap); }\n\n  set positionTable(posTable) {\n    setPositionTable(posTable, this.__stateMap);\n    // ensure that a cooled layout will update\n    this.force.resume();\n  }\n}\n\n// Positioning\n\n// {[key: State]: Node} -> PositionTable\nconst getPositionTable = _.mapValues(_.pick(['x', 'y', 'px', 'py', 'fixed']));\n\n// Tag nodes w/ positions. Mutates the node map.\n// PositionTable -> {[key: State]: Node} -> void\nfunction setPositionTable(posTable, stateMap) {\n  _.forEach((node, state) => {\n    const position = posTable[state];\n    if (position !== undefined) {\n      assign(node, position);\n    }\n  }, stateMap);\n}\n\n\nmodule.exports = StateViz;\n","'use strict';\n\nconst { isBrowserIEorEdge } = require('./util');\n/* global localStorage:false, window:false */\n\n///////////////////////\n// Key-Value Storage //\n///////////////////////\n\nconst canUseLocalStorage = (() => {\n  // from modernizr v3.3.1 (modernizr.com)\n  const mod = 'modernizr';\n  try {\n    localStorage.setItem(mod, mod);\n    localStorage.removeItem(mod);\n    return true;\n  } catch (e) {\n    return false;\n  }\n})();\n\n// RAM-only fallback\nconst RAMStorage = (() => {\n  let obj = {};\n  return Object.freeze({\n    get length() { return Object.keys(obj).length; },\n    key: function (n) { return (n in Object.keys(obj)) ? Object.keys(obj)[n] : null; },\n    getItem: function (key) { return {}.hasOwnProperty.call(obj, key) ? obj[key] : null; },\n    setItem: function (key, val) { obj[key] = String(val); },\n    removeItem: function (key) { delete obj[key]; },\n    clear: function () { obj = {}; }\n  });\n})();\n\nconst KeyValueStorage = (() => {\n  const s = canUseLocalStorage ? localStorage : RAMStorage;\n\n  // workaround IE/Edge firing events on its own window\n  const fromOwnWindow = isBrowserIEorEdge\n    ? () => { return window.document.hasFocus(); }\n    : () => { return false; };\n\n  return {\n    read  : s.getItem.bind(s),\n    write : s.setItem.bind(s),\n    remove: s.removeItem.bind(s),\n    // Registers a listener for StorageEvents from other tabs/windows.\n    addStorageListener: canUseLocalStorage\n      ? listener => {\n        window.addEventListener('storage', e => {\n          if (fromOwnWindow()) {\n            return;\n          }\n          if (e.storageArea === localStorage) {\n            listener(e);\n          }\n        });\n      }\n      : () => {},\n    removeStorageListener: canUseLocalStorage\n      ? window.removeEventListener.bind(window, 'storage')\n      : () => {}\n  };\n})();\n\n\nexports.canUseLocalStorage = canUseLocalStorage;\nexports.KeyValueStorage = KeyValueStorage;\n","'use strict';\nconst _ = require('lodash/fp');\n\n// Bidirectional infinite tape\nclass Tape {\n  constructor(blank, input) {\n    Object.defineProperty(this, 'blank', {\n      value: blank,\n      writable: false,\n      enumerable: true\n    });\n    // zipper data structure\n    // INVARIANTS: tape.before can be empty, tape.after must be nonempty.\n    // before: cells before the head (in order; left to right).\n    // after:  cells after and including the head (in reverse; right to left).\n    this.tape = {\n      before: [],\n      after: (input == null || input.length == 0) ? [blank] : input.slice().reverse(),\n      toString: function () {\n        return this.before.join('') + '' + this.after.slice().reverse().join('');\n      }\n    };\n  }\n\n  // Read the value at the tape head.\n  read() {\n    return _.last(this.tape.after);\n  }\n\n  write(symbol) {\n    this.tape.after[this.tape.after.length - 1] = symbol;\n  }\n\n  headRight() {\n    const { before, after } = this.tape;\n    before.push(after.pop());\n    if (_.isEmpty(after)) {\n      after.push(this.blank);\n    }\n  }\n\n  headLeft() {\n    const { before, after } = this.tape;\n    if (_.isEmpty(before)) {\n      before.push(this.blank);\n    }\n    after.push(before.pop());\n  }\n\n  toString() {\n    return this.tape.toString();\n  }\n\n  // for tape visualization. not part of TM definition.\n  // Read the value at an offset from the tape head.\n  // 0 is the tape head. + is to the right, - to the left.\n  readOffset(i) {\n    const { tape } = this;\n    if (i >= 0) {\n      // right side: offset [0..length-1]  array index [length-1..0]\n      return (i <= tape.after.length - 1) ? tape.after[tape.after.length - 1 - i] : this.blank;\n    } else {\n      // left side: offset [-1..-length]  array index [length-1..0]\n      return (i >= -tape.before.length) ? tape.before[tape.before.length + i] : this.blank;\n    }\n  }\n\n  // for tape visualization.\n  // Read the values from an offset range (inclusive of start and end).\n  readRange(start, end) {\n    return _.range(start, end+1).map(function (i) {\n      return this.readOffset(i);\n    }, this);\n  }\n}\n\nmodule.exports = Tape;\n","'use strict';\nconst Tape = require('./Tape.js');\nconst d3   = require('d3');\nrequire('./tape.css');\n\nconst cellWidth = 50;\nconst cellHeight = 50;\n\nfunction initTapeCells(selection) {\n  selection.attr('class', 'tape-cell');\n  selection.append('rect')\n  // the box outline is purely visual, so remove its data binding\n    .datum(null)\n    .attr({'width': cellWidth,\n      'height': cellHeight});\n  selection.append('text')\n    .text(d => { return d; })\n    .attr({'x': cellWidth/2, 'y': cellHeight/2 + 8});\n  return selection;\n}\n\nfunction positionCells(selection, offset) {\n  offset = (offset == null) ? 0 : offset;\n  selection.attr('transform', (d, i) => {\n    return 'translate(' + (-cellWidth+10 + cellWidth*(i+offset)) + ')';\n  });\n  return selection;\n}\n\nfunction repositionWrapper(wrapper) {\n  wrapper.attr('transform', 'translate(0 10)')\n    .transition()\n    .duration(0)\n    .select('.exiting')\n    .remove();\n}\n\n// Tape visualization centered around the tape head.\nclass TapeViz extends Tape {\n  constructor(svg, lookaround, blank, input) {\n    super(blank, input);\n\n    Object.defineProperty(this, 'lookaround', {\n      value: lookaround,\n      writable: false,\n      enumerable: true\n    });\n    Object.defineProperty(this, 'domNode', {\n      value: svg,\n      writable: false,\n      enumerable: true\n    });\n\n    // width is before + head + after, trimming 2 off to show cut-off tape ends\n    const width  = cellWidth * (lookaround+1+lookaround-2) + 2*10;\n    const height = cellHeight + 2*10;\n    svg.attr({\n      'width': '95%',\n      'viewBox': [0, 0, width, height].join(' ')\n    });\n\n    this.wrapper = svg.append('g')\n      .attr('class', 'wrapper')\n      .call(repositionWrapper);\n\n    svg.append('rect')\n      .attr({'id': 'tape-head',\n        'width': (1+1/5) * cellWidth,\n        'height': (1+1/5) * cellHeight,\n        'x': -cellWidth+10/2 + cellWidth*lookaround,\n        'y': 10/2\n      });\n\n    this.wrapper.selectAll('.tape-cell')\n      .data(this.readRange(-lookaround, lookaround))\n      .enter()\n      .append('g')\n      .call(initTapeCells)\n      .call(positionCells)\n    ;\n  }\n\n  // IDEA: chain headLeft/Right to wait for write()?\n  write(symbol) {\n    // don't animate if symbol stays the same\n    if (Tape.prototype.read.call(this) === symbol) {\n      return;\n    }\n    super.write(symbol);\n\n    // remove leftover .exiting in case animation was interrupted\n    this.wrapper.selectAll('.exiting').remove();\n\n    d3.select(this.wrapper[0][0].childNodes[this.lookaround])\n      .datum(symbol)\n      .select('text')\n      .attr('fill-opacity', '1')\n      .attr('stroke-opacity', '1')\n      .transition()\n      .attr('fill-opacity', '0.4')\n      .attr('stroke-opacity', '0.1')\n      .transition()\n      .text(d => { return d; })\n      .attr('fill-opacity', '1')\n      .attr('stroke-opacity', '1')\n      .transition()\n      .duration(0)\n      .attr('fill-opacity', null)\n      .attr('stroke-opacity', null)\n    ;\n  }\n\n  headRight() {\n    super.headRight();\n    // remove leftover .exiting in case animation was interrupted.\n    // Important: call-by-value evaluates the selection argument(s) of 'moveHead' before\n    // before entering the function, so exiting nodes have to be removed beforehand.\n    this.wrapper.selectAll('.exiting').remove();\n    moveHead(this.wrapper,\n      // add to right end\n      this.wrapper.append('g')\n        .datum(this.readOffset(this.lookaround)),\n      // remove from left end\n      this.wrapper.select('.tape-cell'),\n      1, -1);\n  }\n\n  headLeft() {\n    super.headLeft();\n    this.wrapper.selectAll('.exiting').remove();\n    moveHead(this.wrapper,\n      this.wrapper.insert('g', ':first-child')\n        .datum(this.readOffset(-this.lookaround)),\n      this.wrapper.select('.wrapper > .tape-cell:last-of-type'),\n      -1, 0);\n  }\n}\n\nfunction moveHead(wrapper, enter, exit, wOffset, cOffset) {\n  // add to one end\n  enter.call(initTapeCells);\n  // remove from the other end\n  exit.classed('exiting', true);\n  // translate cells forward, and the wrapper backwards\n  wrapper.selectAll('.tape-cell')\n    .call(positionCells, cOffset);\n  wrapper\n    .attr('transform', 'translate(' + (wOffset*cellWidth).toString() + ' 10)')\n    // animate wrapper returning to neutral position\n    .transition()\n    .call(repositionWrapper);\n}\n\nmodule.exports = TapeViz;\n","'use strict';\n// misc. utilities\n\n//////////////////////////////////\n// Utilities for null/undefined //\n//////////////////////////////////\n\n// Assert non-null.\n// Return the value if it is not null or undefined; otherwise, throw an error.\nfunction nonNull(value) {\n  if (value == null) {\n    throw new Error('expected a non-null defined value, but got: ' + String(value));\n  }\n  return value;\n}\n\n// Null coalescing: iff the first argument is null or undefined, return the second.\nfunction coalesce(a, b) {\n  return (a != null) ? a : b;\n}\n\n// Apply a function to a value if non-null, otherwise return the value.\n// (Monadic bind for maybe (option) type.)\n// ((a -> b), ?a) -> ?b\nfunction applyMaybe(f, x) {\n  return (x != null) ? f(x) : x;\n}\n\n// Returns the first function result that is not null or undefined.\n// Otherwise, returns undefined.\n// ((a -> ?b), [a]) -> ?b\nfunction getFirst(f, xs) {\n  for (let i = 0; i < xs.length; ++i) {\n    const val = f(xs[i]);\n    if (val != null) {\n      return val;\n    }\n  }\n}\n\n/////////\n// DOM //\n/////////\n\n/* global document */\n\n/**\n * Concat an array of DOM Nodes into a DocumentFragment.\n * @param  {[Node]} array\n * @return {DocumentFragment}\n */\nfunction toDocFragment(array) {\n  const result = document.createDocumentFragment();\n  array.forEach(result.appendChild.bind(result));\n  return result;\n}\n\n///////////////////////\n// IE/Edge detection //\n///////////////////////\n\n// http://stackoverflow.com/a/9851769\nconst isBrowserIEorEdge = /*@cc_on!@*/false\n  || Boolean(document.documentMode) || Boolean(window.StyleMedia); // eslint-disable-line\n\n\nexports.nonNull = nonNull;\nexports.coalesce = coalesce;\nexports.applyMaybe = applyMaybe;\nexports.getFirst = getFirst;\n\nexports.toDocFragment = toDocFragment;\n\nexports.isBrowserIEorEdge = isBrowserIEorEdge;\n","'use strict';\n/**\n * Lightweight property assignment watching by overriding getters/setters.\n * Intended as a bridge between plain JS properties and other libraries.\n *\n * Inspired by https://gist.github.com/eligrey/384583, which works for\n * data properties only, this works for both data and accessor properties.\n *\n * 2015-11-21\n * @author Andy Li\n */\n\n/**\n * Watches a property for assignment by overriding it with a getter & setter\n * on top of the previous value or accessors.\n *\n * The handler can intercept assignments by returning a different value.\n * Watching an unwritable/unsettable property does nothing, but trying to watch\n * a non-existent or non-configurable property fails fast with TypeError.\n * @param  {!Object} thisArg The object that contains the property.\n * @param  {String}  prop    The name of the property to watch.\n * @param            handler The function to call when the property is\n *   assigned to. Important: this function intercepts assignment;\n *   its return value is set as the new value.\n * @throws {TypeError} if object is null or does not have the property\n * @throws {TypeError} if thisArg.prop is non-configurable\n * @return {?Object}         The previous property descriptor, or null if the\n *   property is not writable/settable.\n */\nfunction watch(thisArg, prop, handler) {\n  const desc = Object.getOwnPropertyDescriptor(thisArg, prop);\n  // check pre-conditions: existent, configurable, writable/settable\n  if (desc === undefined) {\n    throw new TypeError('Cannot watch nonexistent property \\''+prop+'\\'');\n  } else if (!desc.configurable) {\n    throw new TypeError('Cannot watch non-configurable property \\''+prop+'\\'');\n  } else if (!desc.writable && desc.set === undefined) {\n    return; // no-op since property can't change without reconfiguration\n  }\n\n  const accessors = (() => {\n    if (desc.set) {\n      // case: .get/.set\n      return {\n        get: desc.get,\n        set: function (newval) {\n          return desc.set.call(thisArg, handler.call(thisArg, prop, thisArg[prop], newval));\n        }\n      };\n    } else {\n      // case: .value\n      let val = desc.value;\n      return {\n        get: function () {\n          return val;\n        },\n        set: function (newval) {\n          return val = handler.call(thisArg, prop, val, newval);\n        }\n      };\n    }\n  })();\n  Object.defineProperty(thisArg, prop, accessors);\n\n  return desc;\n}\n\n/**\n * {@link watch} that, if successful, also calls the handler once with\n *   the current value (by setting it).\n * @see watch\n */\nfunction watchInit(thisArg, prop, handler) {\n  const value = thisArg[prop];\n  const desc = watch(thisArg, prop, handler);\n  if (desc) { thisArg[prop] = value; }\n  return desc;\n}\n\nif (typeof exports === 'object') {\n  exports.watch = watch;\n  exports.watchInit = watchInit;\n}\n","module.exports = ClipboardJS;","module.exports = Promise;","module.exports = _;","module.exports = ace;","module.exports = d3;","module.exports = jQuery;","module.exports = jsyaml;","module.exports = lodash;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// module exports must be returned from runtime so entry inlining is disabled\n// startup\n// Load entry module and return exports\nreturn __webpack_require__(2225);\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop)","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.p = \"/build/\";"],"sourceRoot":""}